{"ast":null,"code":"var _jsxFileName = \"/home/mhmdal/Projects/moveo-master/moveo/src/pages/Routes/CreateRoute.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { FiSave, FiArrowLeft, FiPlus, FiX } from 'react-icons/fi';\nimport { theme } from '../../styles/theme';\nimport { Card, Button, Input } from '../../styles/GlobalStyles';\nimport RouteMap from '../../components/Map/RouteMap';\nimport { dataService } from '../../services/dataService';\nimport { RoutingService } from '../../services/routingService';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst CreateRouteContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: ${theme.spacing.xl};\n  max-width: 1200px;\n  margin: 0 auto;\n`;\n_c = CreateRouteContainer;\nconst PageHeader = styled.div`\n  display: flex;\n  align-items: center;\n  gap: ${theme.spacing.md};\n`;\n_c2 = PageHeader;\nconst BackButton = styled(Button)`\n  padding: ${theme.spacing.sm};\n`;\n_c3 = BackButton;\nconst PageTitle = styled.h1`\n  font-size: ${theme.typography.fontSize['3xl']};\n  font-weight: ${theme.typography.fontWeight.bold};\n  color: ${theme.colors.textPrimary};\n  margin: 0;\n`;\n_c4 = PageTitle;\nconst ContentLayout = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: ${theme.spacing.lg};\n  height: calc(100vh - 120px);\n`;\n_c5 = ContentLayout;\nconst RouteInfoCard = styled(Card)`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  gap: ${theme.spacing.lg};\n  padding: ${theme.spacing.md} ${theme.spacing.lg};\n  margin-bottom: ${theme.spacing.md};\n`;\n_c6 = RouteInfoCard;\nconst MapContainer = styled.div`\n  position: relative;\n  flex: 1;\n  min-height: 0;\n  border-radius: ${theme.borderRadius.lg};\n  overflow: hidden;\n  box-shadow: ${theme.shadows.lg};\n`;\n_c7 = MapContainer;\nconst RouteSummary = styled.div`\n  position: absolute;\n  bottom: 80px;\n  left: ${theme.spacing.lg};\n  background: rgba(0, 0, 0, 0.8);\n  color: white;\n  padding: ${theme.spacing.md} ${theme.spacing.lg};\n  border-radius: ${theme.borderRadius.lg};\n  backdrop-filter: blur(10px);\n  z-index: 1000;\n  min-width: 200px;\n  max-width: calc(100% - ${theme.spacing.xl} - 320px - ${theme.spacing.lg});\n  max-height: calc(100% - ${theme.spacing.xl} * 2);\n  overflow-y: auto;\n`;\nconst SummaryItem = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin: ${theme.spacing.xs} 0;\n  font-size: ${theme.typography.fontSize.sm};\n`;\nconst SummaryLabel = styled.span`\n  opacity: 0.8;\n`;\nconst SummaryValue = styled.span`\n  font-weight: ${theme.typography.fontWeight.semibold};\n`;\nconst FormGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: ${theme.spacing.sm};\n`;\n_c8 = FormGroup;\nconst Label = styled.label`\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  color: ${theme.colors.textPrimary};\n`;\n_c9 = Label;\nconst RequiredIndicator = styled.span`\n  color: ${theme.colors.error};\n`;\n_c0 = RequiredIndicator;\nconst SectionTitle = styled.h3`\n  font-size: ${theme.typography.fontSize.lg};\n  font-weight: ${theme.typography.fontWeight.semibold};\n  color: ${theme.colors.textPrimary};\n  margin: 0;\n  display: flex;\n  align-items: center;\n  gap: ${theme.spacing.sm};\n`;\nconst ActionButtons = styled.div`\n  display: flex;\n  gap: ${theme.spacing.md};\n  justify-content: flex-end;\n  padding-top: ${theme.spacing.lg};\n  border-top: 1px solid ${theme.colors.border};\n`;\n_c1 = ActionButtons;\nconst EmptyState = styled.div`\n  text-align: center;\n  padding: ${theme.spacing.xl};\n  color: ${theme.colors.textMuted};\n`;\nconst ModeIndicator = styled.div`\n  position: absolute;\n  top: ${theme.spacing.md};\n  right: ${theme.spacing.md};\n  background-color: ${theme.colors.primary};\n  color: white;\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  border-radius: ${theme.borderRadius.md};\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  z-index: 1000;\n  box-shadow: ${theme.shadows.md};\n  opacity: 0.9;\n  transition: opacity 0.3s ease;\n\n  &:hover {\n    opacity: 1;\n  }\n`;\nconst ModalOverlay = styled.div`\n  display: ${props => props.$isOpen ? 'flex' : 'none'};\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  justify-content: center;\n  align-items: center;\n  z-index: 2000;\n`;\n_c10 = ModalOverlay;\nconst ModalContent = styled.div`\n  background-color: ${theme.colors.card};\n  border-radius: ${theme.borderRadius.lg};\n  padding: ${theme.spacing.lg};\n  width: 90%;\n  max-width: 400px;\n  box-shadow: ${theme.shadows.lg};\n`;\n_c11 = ModalContent;\nconst ModalTitle = styled.h3`\n  margin: 0 0 ${theme.spacing.md} 0;\n  font-size: ${theme.typography.fontSize.lg};\n  color: ${theme.colors.textPrimary};\n  font-weight: ${theme.typography.fontWeight.semibold};\n`;\n_c12 = ModalTitle;\nconst ModalFormGroup = styled.div`\n  margin-bottom: ${theme.spacing.md};\n`;\n_c13 = ModalFormGroup;\nconst ModalLabel = styled.label`\n  display: block;\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  color: ${theme.colors.textPrimary};\n  margin-bottom: ${theme.spacing.xs};\n`;\n_c14 = ModalLabel;\nconst ModalInput = styled(Input)`\n  width: 100%;\n`;\n_c15 = ModalInput;\nconst ModalButtons = styled.div`\n  display: flex;\n  gap: ${theme.spacing.md};\n  justify-content: flex-end;\n  margin-top: ${theme.spacing.lg};\n`;\n_c16 = ModalButtons;\nconst CreateRoute = () => {\n  _s();\n  const navigate = useNavigate();\n  const {\n    id\n  } = useParams();\n  const [formData, setFormData] = useState({\n    name: '',\n    code: '',\n    description: ''\n  });\n  const [availableStops, setAvailableStops] = useState([]);\n  const [selectedStops, setSelectedStops] = useState([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [filteredStops, setFilteredStops] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showAllStops, setShowAllStops] = useState(false);\n  const [isAddingMode, setIsAddingMode] = useState(false);\n  const [manualStopCounter, setManualStopCounter] = useState(1);\n  const mapContainerRef = React.useRef(null);\n  const [isManualStopModalOpen, setIsManualStopModalOpen] = useState(false);\n  const [tempManualStop, setTempManualStop] = useState(null);\n  useEffect(() => {\n    const loadRouteAndStops = async () => {\n      try {\n        if (id) {\n          const route = await dataService.getRouteById(id);\n          if (route) {\n            const routeData = route;\n            setFormData({\n              name: routeData.name,\n              code: routeData.code,\n              description: routeData.description || ''\n            });\n            // Extract stops from routeStops structure (backend format)\n            const stopsFromRoute = (routeData.routeStops || routeData.stops || []).map(item => {\n              var _stopData$location, _stopData$location2, _stopData$location3, _stopData$location4;\n              // Handle both direct stops and nested stop structure\n              const stopData = item.stop || item;\n              return {\n                id: stopData.id,\n                name: stopData.name,\n                code: stopData.code,\n                location: {\n                  lat: ((_stopData$location = stopData.location) === null || _stopData$location === void 0 ? void 0 : _stopData$location.lat) || ((_stopData$location2 = stopData.location) === null || _stopData$location2 === void 0 ? void 0 : _stopData$location2.latitude),\n                  lon: ((_stopData$location3 = stopData.location) === null || _stopData$location3 === void 0 ? void 0 : _stopData$location3.lon) || ((_stopData$location4 = stopData.location) === null || _stopData$location4 === void 0 ? void 0 : _stopData$location4.longitude)\n                },\n                order: item.stopOrder || 0,\n                _segmentPath: item.path // Store segment path for later use\n              };\n            })\n            // Sort by stopOrder from backend\n            .sort((a, b) => a.order - b.order);\n            setSelectedStops(stopsFromRoute);\n\n            // If we have segment paths stored, pass them as precalculated route data\n            // This prevents RouteMap from recalculating via ORS\n            const segmentPaths = (routeData.routeStops || []).map(item => item.path).filter(p => p);\n            if (segmentPaths.length > 0) {\n              // For now, store segment paths - RouteMap will use them to skip recalculation\n              // setPrecalculatedRouteData({\n              //   hasSegments: true,\n              //   segmentPaths: segmentPaths,\n              //   segments: routeData.routeStops\n              // });\n            }\n          } else {\n            throw new Error('Route not found');\n          }\n        } else {\n          setIsAddingMode(true);\n        }\n        const stops = await dataService.getStops();\n        setAvailableStops(stops);\n        setFilteredStops(stops);\n      } catch (error) {\n        console.error('Error loading route or stops:', error);\n        alert('Error loading route or stops. Please try again.');\n        navigate('/routes');\n      } finally {\n        setLoading(false);\n      }\n    };\n    loadRouteAndStops();\n  }, [id, navigate]);\n\n  // Handler for when user clicks the map in adding mode\n  const handleMapClickForAddingStop = (lat, lng) => {\n    console.log('✅ Map clicked at:', {\n      lat,\n      lng\n    });\n    const manualStop = {\n      id: `0`,\n      name: `Stop ${selectedStops.length + 1}`,\n      code: `STOP-${manualStopCounter}`,\n      order: selectedStops.length,\n      location: {\n        lat: parseFloat(lat.toFixed(6)),\n        lon: parseFloat(lng.toFixed(6))\n      }\n    };\n    setTempManualStop(manualStop);\n    setIsManualStopModalOpen(true);\n  };\n  const handleManualStopModalChange = (field, value) => {\n    if (!tempManualStop) return;\n    setTempManualStop(prev => prev ? {\n      ...prev,\n      [field]: value\n    } : null);\n  };\n  const handleConfirmManualStop = () => {\n    if (!tempManualStop || !tempManualStop.name || !tempManualStop.code) {\n      alert('Please enter both name and code for the stop.');\n      return;\n    }\n\n    // Calculate segment path and ETA from previous stop if exists\n    const addManualStop = async () => {\n      let segmentPath = null;\n      let eta = null;\n      const newStopOrder = selectedStops.length; // Add at end\n\n      if (selectedStops.length > 0) {\n        try {\n          const prevStop = selectedStops[selectedStops.length - 1];\n          const waypoints = [{\n            lat: prevStop.location.lat,\n            lng: prevStop.location.lon\n          }, {\n            lat: tempManualStop.location.lat,\n            lng: tempManualStop.location.lon\n          }];\n          const routeData = await RoutingService.calculateRoute(waypoints);\n          segmentPath = (routeData === null || routeData === void 0 ? void 0 : routeData.geometry) || null;\n          // Calculate ETA in minutes from duration in seconds\n          eta = routeData !== null && routeData !== void 0 && routeData.duration ? Math.round(routeData.duration / 60) : null;\n        } catch (error) {\n          console.error('Error calculating segment path:', error);\n        }\n      }\n      setSelectedStops(prev => [...prev, {\n        ...tempManualStop,\n        _segmentPath: segmentPath,\n        _eta: eta,\n        order: newStopOrder\n      }]);\n      setManualStopCounter(prev => prev + 1);\n      setIsManualStopModalOpen(false);\n      setTempManualStop(null);\n    };\n    addManualStop();\n  };\n  const handleCancelManualStop = () => {\n    setIsManualStopModalOpen(false);\n    setTempManualStop(null);\n  };\n  useEffect(() => {\n    const filtered = availableStops.filter(stop => stop.name.toLowerCase().includes(searchTerm.toLowerCase()) || stop.code.toLowerCase().includes(searchTerm.toLowerCase()));\n    setFilteredStops(filtered);\n  }, [availableStops, searchTerm]);\n  const handleInputChange = (field, value) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n  const handleAddStop = stop => {\n    if (!selectedStops.find(s => String(s.id) === String(stop.id))) {\n      // Calculate segment path and ETA from previous stop if exists\n      const calculateSegmentPath = async () => {\n        let segmentPath = null;\n        let eta = null;\n        const newStopOrder = selectedStops.length; // Add at end\n\n        if (selectedStops.length > 0) {\n          try {\n            const prevStop = selectedStops[selectedStops.length - 1];\n            const waypoints = [{\n              lat: prevStop.location.lat,\n              lng: prevStop.location.lon\n            }, {\n              lat: stop.location.lat,\n              lng: stop.location.lon\n            }];\n            const routeData = await RoutingService.calculateRoute(waypoints);\n            segmentPath = (routeData === null || routeData === void 0 ? void 0 : routeData.geometry) || null;\n            // Calculate ETA in minutes from duration in seconds\n            eta = routeData !== null && routeData !== void 0 && routeData.duration ? Math.round(routeData.duration / 60) : null;\n          } catch (error) {\n            console.error('Error calculating segment path:', error);\n          }\n        }\n\n        // Add stop with its stopOrder and ETA\n        setSelectedStops(prev => [...prev, {\n          ...stop,\n          _segmentPath: segmentPath,\n          _eta: eta,\n          order: newStopOrder\n        }]);\n      };\n      calculateSegmentPath();\n    }\n  };\n  const handleMapStopClick = stop => {\n    handleAddStop(stop);\n  };\n  const handleFitRoute = () => {\n    setSelectedStops(prev => [...prev]);\n  };\n  const handleToggleShowAllStops = () => {\n    setShowAllStops(prev => !prev);\n  };\n  const handleRemoveStop = async stopOrder => {\n    // Create a new list by filtering out the stop\n    let newStops = selectedStops.filter(stop => stop.order !== stopOrder);\n    if (newStops.length === 0) {\n      setSelectedStops(newStops);\n      return;\n    }\n\n    // If first stop was deleted, clear the path of the new first stop\n    if (stopOrder === 0) {\n      newStops = newStops.map((stop, idx) => ({\n        ...stop,\n        order: idx,\n        _segmentPath: idx === 0 ? null : stop._segmentPath\n      }));\n      setSelectedStops(newStops);\n      return;\n    }\n\n    // If there's a stop that needs recalculation (stopOrder N-1 connecting to N+1)\n    if (stopOrder > 0) {\n      // Find stops by their order property in the ORIGINAL array\n      const fromStop = selectedStops.find(s => s.order === stopOrder - 1);\n      const toStop = selectedStops.find(s => s.order === stopOrder + 1);\n      if (fromStop && toStop) {\n        try {\n          const waypoints = [{\n            lat: fromStop.location.lat,\n            lng: fromStop.location.lon\n          }, {\n            lat: toStop.location.lat,\n            lng: toStop.location.lon\n          }];\n          const routeData = await RoutingService.calculateRoute(waypoints);\n          const segmentPath = (routeData === null || routeData === void 0 ? void 0 : routeData.geometry) || null;\n          const eta = routeData !== null && routeData !== void 0 && routeData.duration ? Math.round(routeData.duration / 60) : null;\n\n          // Update the specific stop with the recalculated path and ETA\n          newStops = newStops.map(stop => stop.order === stopOrder + 1 ? {\n            ...stop,\n            _segmentPath: segmentPath,\n            _eta: eta\n          } : stop);\n        } catch (error) {\n          console.error('Error recalculating segment path:', error);\n        }\n      }\n    }\n\n    // Reassign order to all remaining stops\n    newStops = newStops.map((stop, idx) => ({\n      ...stop,\n      order: idx\n    }));\n\n    // Single setSelectedStops call with all updates\n    setSelectedStops(newStops);\n  };\n  const handleMoveStop = (fromIndex, toIndex) => {\n    const newStops = [...selectedStops];\n    const [movedStop] = newStops.splice(fromIndex, 1);\n    newStops.splice(toIndex, 0, movedStop);\n    setSelectedStops(newStops);\n  };\n  const handleToggleAddingMode = () => {\n    setIsAddingMode(prev => !prev);\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!formData.name || !formData.code) {\n      alert('Please fill in all required fields and select at least 2 stops.');\n      return;\n    }\n    setIsSubmitting(true);\n    try {\n      // Use pre-calculated segment paths and ETAs if available, otherwise calculate them\n      const segmentPaths = [];\n      const etas = [];\n      if (selectedStops.length >= 2) {\n        // For each stop, use its pre-calculated _segmentPath and _eta if available\n        for (let i = 0; i < selectedStops.length; i++) {\n          const stop = selectedStops[i];\n          // stopOrder should equal i, segment path and eta are stored on the stop\n          if (stop._segmentPath !== undefined) {\n            // Use pre-calculated path\n            segmentPaths.push(stop._segmentPath);\n            etas.push(stop._eta || null);\n          } else if (i > 0) {\n            // Calculate if not pre-calculated\n            try {\n              const fromStop = selectedStops[i - 1];\n              const toStop = selectedStops[i];\n              const waypoints = [{\n                lat: fromStop.location.lat,\n                lng: fromStop.location.lon\n              }, {\n                lat: toStop.location.lat,\n                lng: toStop.location.lon\n              }];\n              const routeData = await RoutingService.calculateRoute(waypoints);\n              segmentPaths.push((routeData === null || routeData === void 0 ? void 0 : routeData.geometry) || null);\n              // Calculate ETA in minutes from duration in seconds\n              const eta = routeData !== null && routeData !== void 0 && routeData.duration ? Math.round(routeData.duration / 60) : null;\n              etas.push(eta);\n            } catch (segmentError) {\n              console.error(`Error calculating segment ${i}:`, segmentError);\n              segmentPaths.push(null);\n              etas.push(null);\n            }\n          } else {\n            // First stop has no incoming path or ETA\n            segmentPaths.push(null);\n            etas.push(null);\n          }\n        }\n      }\n      const newRoute = {\n        name: formData.name,\n        code: formData.code,\n        stops: selectedStops.map((stop, idx) => ({\n          ...stop,\n          stopOrder: idx\n        })),\n        segmentPaths: segmentPaths,\n        etas: etas\n      };\n      console.log('Creating/Updating route:', newRoute);\n      if (id) {\n        await dataService.updateRoute(id, {\n          ...newRoute,\n          id\n        });\n        // alert('Route updated successfully!');\n      } else {\n        await dataService.createRoute(newRoute);\n        // alert('Route created successfully!');\n      }\n      navigate('/routes');\n    } catch (error) {\n      console.error('Error creating/updating route:', error);\n      alert('Error creating/updating route. Please try again.');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n  const handleCancel = () => {\n    navigate('/routes');\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Loading stops...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 583,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(CreateRouteContainer, {\n    className: \"fade-in\",\n    children: [/*#__PURE__*/_jsxDEV(PageHeader, {\n      children: [/*#__PURE__*/_jsxDEV(BackButton, {\n        variant: \"secondary\",\n        onClick: handleCancel,\n        children: /*#__PURE__*/_jsxDEV(FiArrowLeft, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 590,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 589,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(PageTitle, {\n        children: id ? 'Edit Route' : 'Create New Route'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 592,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 588,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ContentLayout, {\n      children: [/*#__PURE__*/_jsxDEV(RouteInfoCard, {\n        children: [/*#__PURE__*/_jsxDEV(FormGroup, {\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            children: [\"Route Name \", /*#__PURE__*/_jsxDEV(RequiredIndicator, {\n              children: \"*\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 600,\n              columnNumber: 26\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 599,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            type: \"text\",\n            placeholder: \"Enter route name\",\n            value: formData.name,\n            onChange: e => handleInputChange('name', e.target.value),\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 602,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 598,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormGroup, {\n          children: [/*#__PURE__*/_jsxDEV(Label, {\n            children: [\"Route Code \", /*#__PURE__*/_jsxDEV(RequiredIndicator, {\n              children: \"*\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 613,\n              columnNumber: 26\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 612,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            type: \"text\",\n            placeholder: \"Enter route code (e.g., RT001)\",\n            value: formData.code,\n            onChange: e => handleInputChange('code', e.target.value),\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 615,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 611,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 597,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(MapContainer, {\n        ref: mapContainerRef,\n        children: /*#__PURE__*/_jsxDEV(RouteMap, {\n          stops: isAddingMode ? selectedStops : [...availableStops, ...selectedStops],\n          selectedStops: selectedStops,\n          showRoute: true,\n          height: \"100%\",\n          onStopClick: isAddingMode ? undefined : handleMapStopClick,\n          onFitRoute: handleFitRoute,\n          showAllStops: showAllStops,\n          onToggleShowAllStops: isAddingMode ? handleToggleShowAllStops : handleToggleShowAllStops,\n          searchTerm: searchTerm,\n          onSearchChange: isAddingMode ? undefined : setSearchTerm,\n          filteredStops: filteredStops,\n          onAddStop: isAddingMode ? undefined : handleAddStop,\n          onRemoveStop: handleRemoveStop,\n          onMapClick: isAddingMode ? handleMapClickForAddingStop : undefined,\n          isAddingMode: isAddingMode,\n          onToggleAddingMode: handleToggleAddingMode\n          // precalculatedRouteData={precalculatedRouteData} // Removed as per edit hint\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 627,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 626,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        children: /*#__PURE__*/_jsxDEV(ActionButtons, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            type: \"button\",\n            variant: \"secondary\",\n            onClick: handleCancel,\n            disabled: isSubmitting,\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 652,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            type: \"submit\",\n            variant: \"primary\",\n            disabled: isSubmitting || selectedStops.length < 2,\n            children: [/*#__PURE__*/_jsxDEV(FiSave, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 665,\n              columnNumber: 15\n            }, this), isSubmitting ? id ? 'Updating...' : 'Creating...' : id ? 'Update Route' : 'Create Route']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 660,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 651,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 650,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ModalOverlay, {\n      $isOpen: isManualStopModalOpen,\n      children: /*#__PURE__*/_jsxDEV(ModalContent, {\n        children: [/*#__PURE__*/_jsxDEV(ModalTitle, {\n          children: \"Add Manual Stop\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 675,\n          columnNumber: 11\n        }, this), tempManualStop && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(ModalFormGroup, {\n            children: [/*#__PURE__*/_jsxDEV(ModalLabel, {\n              children: \"Coordinates\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 681,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                padding: '8px 12px',\n                backgroundColor: theme.colors.border,\n                borderRadius: '4px',\n                fontSize: '0.875rem',\n                color: theme.colors.textSecondary\n              },\n              children: [\"Lat: \", tempManualStop.location.lat, \", Lon: \", tempManualStop.location.lon]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 682,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 680,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ModalFormGroup, {\n            children: [/*#__PURE__*/_jsxDEV(ModalLabel, {\n              children: [\"Stop Name \", /*#__PURE__*/_jsxDEV(RequiredIndicator, {\n                children: \"*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 695,\n                columnNumber: 39\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 695,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(ModalInput, {\n              type: \"text\",\n              placeholder: \"Enter stop name\",\n              value: tempManualStop.name,\n              onChange: e => handleManualStopModalChange('name', e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 696,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 694,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ModalFormGroup, {\n            children: [/*#__PURE__*/_jsxDEV(ModalLabel, {\n              children: [\"Stop Code \", /*#__PURE__*/_jsxDEV(RequiredIndicator, {\n                children: \"*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 706,\n                columnNumber: 39\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 706,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(ModalInput, {\n              type: \"text\",\n              placeholder: \"Enter stop code\",\n              value: tempManualStop.code,\n              onChange: e => handleManualStopModalChange('code', e.target.value)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 707,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 705,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(ModalButtons, {\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            type: \"button\",\n            variant: \"secondary\",\n            onClick: handleCancelManualStop,\n            children: [/*#__PURE__*/_jsxDEV(FiX, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 724,\n              columnNumber: 15\n            }, this), \" Cancel\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 719,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            type: \"button\",\n            variant: \"primary\",\n            onClick: handleConfirmManualStop,\n            children: [/*#__PURE__*/_jsxDEV(FiPlus, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 731,\n              columnNumber: 15\n            }, this), \" Add Stop\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 726,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 718,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 674,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 673,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 587,\n    columnNumber: 5\n  }, this);\n};\n_s(CreateRoute, \"3Zo7LWNmnHem1Jf79BLcE4u4uM0=\", false, function () {\n  return [useNavigate, useParams];\n});\n_c17 = CreateRoute;\nexport default CreateRoute;\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c0, _c1, _c10, _c11, _c12, _c13, _c14, _c15, _c16, _c17;\n$RefreshReg$(_c, \"CreateRouteContainer\");\n$RefreshReg$(_c2, \"PageHeader\");\n$RefreshReg$(_c3, \"BackButton\");\n$RefreshReg$(_c4, \"PageTitle\");\n$RefreshReg$(_c5, \"ContentLayout\");\n$RefreshReg$(_c6, \"RouteInfoCard\");\n$RefreshReg$(_c7, \"MapContainer\");\n$RefreshReg$(_c8, \"FormGroup\");\n$RefreshReg$(_c9, \"Label\");\n$RefreshReg$(_c0, \"RequiredIndicator\");\n$RefreshReg$(_c1, \"ActionButtons\");\n$RefreshReg$(_c10, \"ModalOverlay\");\n$RefreshReg$(_c11, \"ModalContent\");\n$RefreshReg$(_c12, \"ModalTitle\");\n$RefreshReg$(_c13, \"ModalFormGroup\");\n$RefreshReg$(_c14, \"ModalLabel\");\n$RefreshReg$(_c15, \"ModalInput\");\n$RefreshReg$(_c16, \"ModalButtons\");\n$RefreshReg$(_c17, \"CreateRoute\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useParams","styled","FiSave","FiArrowLeft","FiPlus","FiX","theme","Card","Button","Input","RouteMap","dataService","RoutingService","jsxDEV","_jsxDEV","Fragment","_Fragment","CreateRouteContainer","div","spacing","xl","_c","PageHeader","md","_c2","BackButton","sm","_c3","PageTitle","h1","typography","fontSize","fontWeight","bold","colors","textPrimary","_c4","ContentLayout","lg","_c5","RouteInfoCard","_c6","MapContainer","borderRadius","shadows","_c7","RouteSummary","SummaryItem","xs","SummaryLabel","span","SummaryValue","semibold","FormGroup","_c8","Label","label","medium","_c9","RequiredIndicator","error","_c0","SectionTitle","h3","ActionButtons","border","_c1","EmptyState","textMuted","ModeIndicator","primary","ModalOverlay","props","$isOpen","_c10","ModalContent","card","_c11","ModalTitle","_c12","ModalFormGroup","_c13","ModalLabel","_c14","ModalInput","_c15","ModalButtons","_c16","CreateRoute","_s","navigate","id","formData","setFormData","name","code","description","availableStops","setAvailableStops","selectedStops","setSelectedStops","searchTerm","setSearchTerm","filteredStops","setFilteredStops","loading","setLoading","isSubmitting","setIsSubmitting","showAllStops","setShowAllStops","isAddingMode","setIsAddingMode","manualStopCounter","setManualStopCounter","mapContainerRef","useRef","isManualStopModalOpen","setIsManualStopModalOpen","tempManualStop","setTempManualStop","loadRouteAndStops","route","getRouteById","routeData","stopsFromRoute","routeStops","stops","map","item","_stopData$location","_stopData$location2","_stopData$location3","_stopData$location4","stopData","stop","location","lat","latitude","lon","longitude","order","stopOrder","_segmentPath","path","sort","a","b","segmentPaths","filter","p","length","Error","getStops","console","alert","handleMapClickForAddingStop","lng","log","manualStop","parseFloat","toFixed","handleManualStopModalChange","field","value","prev","handleConfirmManualStop","addManualStop","segmentPath","eta","newStopOrder","prevStop","waypoints","calculateRoute","geometry","duration","Math","round","_eta","handleCancelManualStop","filtered","toLowerCase","includes","handleInputChange","handleAddStop","find","s","String","calculateSegmentPath","handleMapStopClick","handleFitRoute","handleToggleShowAllStops","handleRemoveStop","newStops","idx","fromStop","toStop","handleMoveStop","fromIndex","toIndex","movedStop","splice","handleToggleAddingMode","handleSubmit","e","preventDefault","etas","i","undefined","push","segmentError","newRoute","updateRoute","createRoute","handleCancel","children","fileName","_jsxFileName","lineNumber","columnNumber","className","variant","onClick","type","placeholder","onChange","target","required","ref","showRoute","height","onStopClick","onFitRoute","onToggleShowAllStops","onSearchChange","onAddStop","onRemoveStop","onMapClick","onToggleAddingMode","onSubmit","disabled","style","padding","backgroundColor","color","textSecondary","_c17","$RefreshReg$"],"sources":["/home/mhmdal/Projects/moveo-master/moveo/src/pages/Routes/CreateRoute.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { \n  FiMap, \n  FiSave, \n  FiArrowLeft, \n  FiPlus, \n  FiX, \n  FiSearch,\n  FiMove,\n  FiMapPin\n} from 'react-icons/fi';\nimport { theme } from '../../styles/theme';\nimport { Card, Button, Input, Select } from '../../styles/GlobalStyles';\nimport RouteMap from '../../components/Map/RouteMap';\nimport { Route, Stop } from '../../types';\nimport { dataService } from '../../services/dataService';\nimport { RoutingService } from '../../services/routingService';\n\nconst CreateRouteContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: ${theme.spacing.xl};\n  max-width: 1200px;\n  margin: 0 auto;\n`;\n\nconst PageHeader = styled.div`\n  display: flex;\n  align-items: center;\n  gap: ${theme.spacing.md};\n`;\n\nconst BackButton = styled(Button)`\n  padding: ${theme.spacing.sm};\n`;\n\nconst PageTitle = styled.h1`\n  font-size: ${theme.typography.fontSize['3xl']};\n  font-weight: ${theme.typography.fontWeight.bold};\n  color: ${theme.colors.textPrimary};\n  margin: 0;\n`;\n\nconst ContentLayout = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: ${theme.spacing.lg};\n  height: calc(100vh - 120px);\n`;\n\nconst RouteInfoCard = styled(Card)`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  gap: ${theme.spacing.lg};\n  padding: ${theme.spacing.md} ${theme.spacing.lg};\n  margin-bottom: ${theme.spacing.md};\n`;\n\nconst MapContainer = styled.div`\n  position: relative;\n  flex: 1;\n  min-height: 0;\n  border-radius: ${theme.borderRadius.lg};\n  overflow: hidden;\n  box-shadow: ${theme.shadows.lg};\n`;\n\n\nconst RouteSummary = styled.div`\n  position: absolute;\n  bottom: 80px;\n  left: ${theme.spacing.lg};\n  background: rgba(0, 0, 0, 0.8);\n  color: white;\n  padding: ${theme.spacing.md} ${theme.spacing.lg};\n  border-radius: ${theme.borderRadius.lg};\n  backdrop-filter: blur(10px);\n  z-index: 1000;\n  min-width: 200px;\n  max-width: calc(100% - ${theme.spacing.xl} - 320px - ${theme.spacing.lg});\n  max-height: calc(100% - ${theme.spacing.xl} * 2);\n  overflow-y: auto;\n`;\n\nconst SummaryItem = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin: ${theme.spacing.xs} 0;\n  font-size: ${theme.typography.fontSize.sm};\n`;\n\nconst SummaryLabel = styled.span`\n  opacity: 0.8;\n`;\n\nconst SummaryValue = styled.span`\n  font-weight: ${theme.typography.fontWeight.semibold};\n`;\n\nconst FormGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: ${theme.spacing.sm};\n`;\n\nconst Label = styled.label`\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  color: ${theme.colors.textPrimary};\n`;\n\nconst RequiredIndicator = styled.span`\n  color: ${theme.colors.error};\n`;\n\nconst SectionTitle = styled.h3`\n  font-size: ${theme.typography.fontSize.lg};\n  font-weight: ${theme.typography.fontWeight.semibold};\n  color: ${theme.colors.textPrimary};\n  margin: 0;\n  display: flex;\n  align-items: center;\n  gap: ${theme.spacing.sm};\n`;\n\n\nconst ActionButtons = styled.div`\n  display: flex;\n  gap: ${theme.spacing.md};\n  justify-content: flex-end;\n  padding-top: ${theme.spacing.lg};\n  border-top: 1px solid ${theme.colors.border};\n`;\n\nconst EmptyState = styled.div`\n  text-align: center;\n  padding: ${theme.spacing.xl};\n  color: ${theme.colors.textMuted};\n`;\n\nconst ModeIndicator = styled.div<{ $isAddingMode: boolean }>`\n  position: absolute;\n  top: ${theme.spacing.md};\n  right: ${theme.spacing.md};\n  background-color: ${theme.colors.primary};\n  color: white;\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  border-radius: ${theme.borderRadius.md};\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  z-index: 1000;\n  box-shadow: ${theme.shadows.md};\n  opacity: 0.9;\n  transition: opacity 0.3s ease;\n\n  &:hover {\n    opacity: 1;\n  }\n`;\n\n\nconst ModalOverlay = styled.div<{ $isOpen: boolean }>`\n  display: ${props => props.$isOpen ? 'flex' : 'none'};\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  justify-content: center;\n  align-items: center;\n  z-index: 2000;\n`;\n\nconst ModalContent = styled.div`\n  background-color: ${theme.colors.card};\n  border-radius: ${theme.borderRadius.lg};\n  padding: ${theme.spacing.lg};\n  width: 90%;\n  max-width: 400px;\n  box-shadow: ${theme.shadows.lg};\n`;\n\nconst ModalTitle = styled.h3`\n  margin: 0 0 ${theme.spacing.md} 0;\n  font-size: ${theme.typography.fontSize.lg};\n  color: ${theme.colors.textPrimary};\n  font-weight: ${theme.typography.fontWeight.semibold};\n`;\n\nconst ModalFormGroup = styled.div`\n  margin-bottom: ${theme.spacing.md};\n`;\n\nconst ModalLabel = styled.label`\n  display: block;\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  color: ${theme.colors.textPrimary};\n  margin-bottom: ${theme.spacing.xs};\n`;\n\nconst ModalInput = styled(Input)`\n  width: 100%;\n`;\n\nconst ModalButtons = styled.div`\n  display: flex;\n  gap: ${theme.spacing.md};\n  justify-content: flex-end;\n  margin-top: ${theme.spacing.lg};\n`;\n\nconst CreateRoute: React.FC = () => {\n  const navigate = useNavigate();\n  const { id } = useParams<{ id?: string }>();\n  const [formData, setFormData] = useState({\n    name: '',\n    code: '',\n    description: ''\n  });\n  const [availableStops, setAvailableStops] = useState<Stop[]>([]);\n  const [selectedStops, setSelectedStops] = useState<Stop[]>([]);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [filteredStops, setFilteredStops] = useState<Stop[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showAllStops, setShowAllStops] = useState(false);\n  const [isAddingMode, setIsAddingMode] = useState(false);\n  const [manualStopCounter, setManualStopCounter] = useState(1);\n  const mapContainerRef = React.useRef<HTMLDivElement>(null);\n  const [isManualStopModalOpen, setIsManualStopModalOpen] = useState(false);\n  const [tempManualStop, setTempManualStop] = useState<Stop | null>(null);\n\n  useEffect(() => {\n    const loadRouteAndStops = async () => {\n      try {\n        if (id) {\n          const route = await dataService.getRouteById(id);\n          if (route) {\n            const routeData = route as any;\n            setFormData({\n              name: routeData.name,\n              code: routeData.code,\n              description: routeData.description || ''\n            });\n            // Extract stops from routeStops structure (backend format)\n            const stopsFromRoute = (routeData.routeStops || routeData.stops || [])\n              .map((item: any) => {\n                // Handle both direct stops and nested stop structure\n                const stopData = item.stop || item;\n                return {\n                  id: stopData.id,\n                  name: stopData.name,\n                  code: stopData.code,\n                  location: {\n                    lat: stopData.location?.lat || stopData.location?.latitude,\n                    lon: stopData.location?.lon || stopData.location?.longitude\n                  },\n                  order: item.stopOrder || 0,\n                  _segmentPath: item.path // Store segment path for later use\n                };\n              })\n              // Sort by stopOrder from backend\n              .sort((a: any, b: any) => a.order - b.order);\n            \n            setSelectedStops(stopsFromRoute);\n            \n            // If we have segment paths stored, pass them as precalculated route data\n            // This prevents RouteMap from recalculating via ORS\n            const segmentPaths = (routeData.routeStops || []).map((item: any) => item.path).filter((p: any) => p);\n            if (segmentPaths.length > 0) {\n              // For now, store segment paths - RouteMap will use them to skip recalculation\n              // setPrecalculatedRouteData({\n              //   hasSegments: true,\n              //   segmentPaths: segmentPaths,\n              //   segments: routeData.routeStops\n              // });\n            }\n          } else {\n            throw new Error('Route not found');\n          }\n        } else {\n          setIsAddingMode(true);\n        }\n\n        const stops = await dataService.getStops();\n        setAvailableStops(stops);\n        setFilteredStops(stops);\n      } catch (error) {\n        console.error('Error loading route or stops:', error);\n        alert('Error loading route or stops. Please try again.');\n        navigate('/routes');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadRouteAndStops();\n  }, [id, navigate]);\n\n  // Handler for when user clicks the map in adding mode\n  const handleMapClickForAddingStop = (lat: number, lng: number) => {\n    console.log('✅ Map clicked at:', { lat, lng });\n    const manualStop: Stop = {\n      id: `0`,\n      name: `Stop ${selectedStops.length + 1}`,\n      code: `STOP-${manualStopCounter}`,\n      order: selectedStops.length,\n      location: {\n        lat: parseFloat(lat.toFixed(6)),\n        lon: parseFloat(lng.toFixed(6))\n      }\n    };\n    setTempManualStop(manualStop);\n    setIsManualStopModalOpen(true);\n  };\n\n  const handleManualStopModalChange = (field: string, value: string) => {\n    if (!tempManualStop) return;\n    setTempManualStop(prev =>\n      prev ? { ...prev, [field]: value } : null\n    );\n  };\n\n  const handleConfirmManualStop = () => {\n    if (!tempManualStop || !tempManualStop.name || !tempManualStop.code) {\n      alert('Please enter both name and code for the stop.');\n      return;\n    }\n    \n    // Calculate segment path and ETA from previous stop if exists\n    const addManualStop = async () => {\n      let segmentPath: string | null = null;\n      let eta: number | null = null;\n      const newStopOrder = selectedStops.length; // Add at end\n      \n      if (selectedStops.length > 0) {\n        try {\n          const prevStop = selectedStops[selectedStops.length - 1];\n          const waypoints = [\n            { lat: prevStop.location.lat, lng: prevStop.location.lon },\n            { lat: tempManualStop.location.lat, lng: tempManualStop.location.lon }\n          ];\n          const routeData = await RoutingService.calculateRoute(waypoints) as any;\n          segmentPath = routeData?.geometry || null;\n          // Calculate ETA in minutes from duration in seconds\n          eta = routeData?.duration ? Math.round(routeData.duration / 60) : null;\n        } catch (error) {\n          console.error('Error calculating segment path:', error);\n        }\n      }\n      \n      setSelectedStops(prev => [...prev, { ...tempManualStop, _segmentPath: segmentPath, _eta: eta, order: newStopOrder } as any]);\n    setManualStopCounter(prev => prev + 1);\n    setIsManualStopModalOpen(false);\n    setTempManualStop(null);\n    };\n    \n    addManualStop();\n  };\n\n  const handleCancelManualStop = () => {\n    setIsManualStopModalOpen(false);\n    setTempManualStop(null);\n  };\n\n  useEffect(() => {\n    const filtered = availableStops.filter(stop =>\n      stop.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      stop.code.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n    setFilteredStops(filtered);\n  }, [availableStops, searchTerm]);\n\n  const handleInputChange = (field: string, value: string) => {\n    setFormData(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const handleAddStop = (stop: Stop) => {\n    if (!selectedStops.find(s => String(s.id) === String(stop.id))) {\n      // Calculate segment path and ETA from previous stop if exists\n      const calculateSegmentPath = async () => {\n        let segmentPath: string | null = null;\n        let eta: number | null = null;\n        const newStopOrder = selectedStops.length; // Add at end\n        \n        if (selectedStops.length > 0) {\n          try {\n            const prevStop = selectedStops[selectedStops.length - 1];\n            const waypoints = [\n              { lat: prevStop.location.lat, lng: prevStop.location.lon },\n              { lat: stop.location.lat, lng: stop.location.lon }\n            ];\n            const routeData = await RoutingService.calculateRoute(waypoints) as any;\n            segmentPath = routeData?.geometry || null;\n            // Calculate ETA in minutes from duration in seconds\n            eta = routeData?.duration ? Math.round(routeData.duration / 60) : null;\n          } catch (error) {\n            console.error('Error calculating segment path:', error);\n          }\n        }\n        \n        // Add stop with its stopOrder and ETA\n        setSelectedStops(prev => [...prev, { ...stop, _segmentPath: segmentPath, _eta: eta, order: newStopOrder } as any]);\n      };\n      \n      calculateSegmentPath();\n    }\n  };\n\n  const handleMapStopClick = (stop: Stop) => {\n    handleAddStop(stop);\n  };\n\n  const handleFitRoute = () => {\n    setSelectedStops(prev => [...prev]);\n  };\n\n  const handleToggleShowAllStops = () => {\n    setShowAllStops(prev => !prev);\n  };\n\n  const handleRemoveStop = async (stopOrder: number) => {\n    // Create a new list by filtering out the stop\n    let newStops = selectedStops.filter((stop: any) => stop.order !== stopOrder);\n    \n    if (newStops.length === 0) {\n      setSelectedStops(newStops);\n      return;\n    }\n    \n    // If first stop was deleted, clear the path of the new first stop\n    if (stopOrder === 0) {\n      newStops = newStops.map((stop: any, idx) => ({ \n        ...stop, \n        order: idx, \n        _segmentPath: idx === 0 ? null : stop._segmentPath \n      } as any));\n      setSelectedStops(newStops);\n      return;\n    }\n    \n    // If there's a stop that needs recalculation (stopOrder N-1 connecting to N+1)\n    if (stopOrder > 0) {\n      // Find stops by their order property in the ORIGINAL array\n      const fromStop = selectedStops.find((s: any) => s.order === stopOrder - 1) as any;\n      const toStop = selectedStops.find((s: any) => s.order === stopOrder + 1) as any;\n      \n      if (fromStop && toStop) {\n        try {\n          const waypoints = [\n            { lat: fromStop.location.lat, lng: fromStop.location.lon },\n            { lat: toStop.location.lat, lng: toStop.location.lon }\n          ];\n          \n          const routeData = await RoutingService.calculateRoute(waypoints) as any;\n          const segmentPath = routeData?.geometry || null;\n          const eta = routeData?.duration ? Math.round(routeData.duration / 60) : null;\n          \n          // Update the specific stop with the recalculated path and ETA\n          newStops = newStops.map((stop: any) => \n            stop.order === stopOrder + 1 \n              ? { ...stop, _segmentPath: segmentPath, _eta: eta }\n              : stop\n          );\n        } catch (error) {\n          console.error('Error recalculating segment path:', error);\n        }\n      }\n    }\n    \n    // Reassign order to all remaining stops\n    newStops = newStops.map((stop: any, idx) => ({ ...stop, order: idx } as any));\n    \n    // Single setSelectedStops call with all updates\n    setSelectedStops(newStops);\n  };\n\n  const handleMoveStop = (fromIndex: number, toIndex: number) => {\n    const newStops = [...selectedStops];\n    const [movedStop] = newStops.splice(fromIndex, 1);\n    newStops.splice(toIndex, 0, movedStop);\n    setSelectedStops(newStops);\n  };\n\n  const handleToggleAddingMode = () => {\n    setIsAddingMode(prev => !prev);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!formData.name || !formData.code) {\n      alert('Please fill in all required fields and select at least 2 stops.');\n      return;\n    }\n\n    setIsSubmitting(true);\n    \n    try {\n      // Use pre-calculated segment paths and ETAs if available, otherwise calculate them\n      const segmentPaths: (string | null)[] = [];\n      const etas: (number | null)[] = [];\n      \n      if (selectedStops.length >= 2) {\n        // For each stop, use its pre-calculated _segmentPath and _eta if available\n        for (let i = 0; i < selectedStops.length; i++) {\n          const stop = selectedStops[i] as any;\n          // stopOrder should equal i, segment path and eta are stored on the stop\n          if (stop._segmentPath !== undefined) {\n            // Use pre-calculated path\n            segmentPaths.push(stop._segmentPath);\n            etas.push(stop._eta || null);\n          } else if (i > 0) {\n            // Calculate if not pre-calculated\n            try {\n              const fromStop = selectedStops[i - 1];\n              const toStop = selectedStops[i];\n              \n              const waypoints = [\n                { lat: fromStop.location.lat, lng: fromStop.location.lon },\n                { lat: toStop.location.lat, lng: toStop.location.lon }\n              ];\n              \n              const routeData = await RoutingService.calculateRoute(waypoints) as any;\n              segmentPaths.push(routeData?.geometry || null);\n              // Calculate ETA in minutes from duration in seconds\n              const eta = routeData?.duration ? Math.round(routeData.duration / 60) : null;\n              etas.push(eta);\n            } catch (segmentError) {\n              console.error(`Error calculating segment ${i}:`, segmentError);\n              segmentPaths.push(null);\n              etas.push(null);\n            }\n          } else {\n            // First stop has no incoming path or ETA\n            segmentPaths.push(null);\n            etas.push(null);\n          }\n        }\n      }\n\n      const newRoute = {\n        name: formData.name,\n        code: formData.code,\n        stops: selectedStops.map((stop, idx) => ({...stop, stopOrder: idx})),\n        segmentPaths: segmentPaths,\n        etas: etas\n      };\n\n      console.log('Creating/Updating route:', newRoute);\n      \n      if (id) {\n        await dataService.updateRoute(id, { ...newRoute, id });\n        // alert('Route updated successfully!');\n      } else {\n      await dataService.createRoute(newRoute);\n        // alert('Route created successfully!');\n      }\n\n      navigate('/routes');\n    } catch (error) {\n      console.error('Error creating/updating route:', error);\n      alert('Error creating/updating route. Please try again.');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleCancel = () => {\n    navigate('/routes');\n  };\n\n  if (loading) {\n    return <div>Loading stops...</div>;\n  }\n\n  return (\n    <CreateRouteContainer className=\"fade-in\">\n      <PageHeader>\n        <BackButton variant=\"secondary\" onClick={handleCancel}>\n          <FiArrowLeft />\n        </BackButton>\n        <PageTitle>{id ? 'Edit Route' : 'Create New Route'}</PageTitle>\n      </PageHeader>\n\n      <ContentLayout>\n        {/* Route Information - Compact Header */}\n        <RouteInfoCard>\n          <FormGroup>\n            <Label>\n              Route Name <RequiredIndicator>*</RequiredIndicator>\n            </Label>\n            <Input\n              type=\"text\"\n              placeholder=\"Enter route name\"\n              value={formData.name}\n              onChange={(e) => handleInputChange('name', e.target.value)}\n              required\n            />\n          </FormGroup>\n          \n          <FormGroup>\n            <Label>\n              Route Code <RequiredIndicator>*</RequiredIndicator>\n            </Label>\n            <Input\n              type=\"text\"\n              placeholder=\"Enter route code (e.g., RT001)\"\n              value={formData.code}\n              onChange={(e) => handleInputChange('code', e.target.value)}\n              required\n            />\n          </FormGroup>\n        </RouteInfoCard>\n\n        {/* Map - Two Modes */}\n        <MapContainer ref={mapContainerRef}>\n          <RouteMap\n            stops={isAddingMode ? selectedStops : [...availableStops, ...selectedStops]}\n            selectedStops={selectedStops}\n            showRoute={true}\n            height=\"100%\"\n            onStopClick={isAddingMode ? undefined : handleMapStopClick}\n            onFitRoute={handleFitRoute}\n            showAllStops={showAllStops}\n            onToggleShowAllStops={isAddingMode ? handleToggleShowAllStops : handleToggleShowAllStops}\n            searchTerm={searchTerm}\n            onSearchChange={isAddingMode ? undefined : setSearchTerm}\n            filteredStops={filteredStops}\n            onAddStop={isAddingMode ? undefined : handleAddStop}\n            onRemoveStop={handleRemoveStop}\n            onMapClick={isAddingMode ? handleMapClickForAddingStop : undefined}\n            isAddingMode={isAddingMode}\n            onToggleAddingMode={handleToggleAddingMode}\n            // precalculatedRouteData={precalculatedRouteData} // Removed as per edit hint\n          />\n          \n        </MapContainer>\n\n        {/* Action Buttons */}\n        <form onSubmit={handleSubmit}>\n          <ActionButtons>\n            <Button \n              type=\"button\" \n              variant=\"secondary\" \n              onClick={handleCancel}\n              disabled={isSubmitting}\n            >\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              variant=\"primary\"\n              disabled={isSubmitting || selectedStops.length < 2}\n            >\n              <FiSave />\n              {isSubmitting ? (id ? 'Updating...' : 'Creating...') : (id ? 'Update Route' : 'Create Route')}\n            </Button>\n          </ActionButtons>\n        </form>\n      </ContentLayout>\n\n      {/* Manual Stop Modal */}\n      <ModalOverlay $isOpen={isManualStopModalOpen}>\n        <ModalContent>\n          <ModalTitle>Add Manual Stop</ModalTitle>\n          \n          {tempManualStop && (\n            <>\n              {/* Display Coordinates */}\n              <ModalFormGroup>\n                <ModalLabel>Coordinates</ModalLabel>\n                <div style={{ \n                  padding: '8px 12px', \n                  backgroundColor: theme.colors.border,\n                  borderRadius: '4px',\n                  fontSize: '0.875rem',\n                  color: theme.colors.textSecondary\n                }}>\n                  Lat: {tempManualStop.location.lat}, Lon: {tempManualStop.location.lon}\n                </div>\n              </ModalFormGroup>\n\n              {/* Stop Name */}\n              <ModalFormGroup>\n                <ModalLabel>Stop Name <RequiredIndicator>*</RequiredIndicator></ModalLabel>\n                <ModalInput\n                  type=\"text\"\n                  placeholder=\"Enter stop name\"\n                  value={tempManualStop.name}\n                  onChange={(e) => handleManualStopModalChange('name', e.target.value)}\n                />\n              </ModalFormGroup>\n\n              {/* Stop Code */}\n              <ModalFormGroup>\n                <ModalLabel>Stop Code <RequiredIndicator>*</RequiredIndicator></ModalLabel>\n                <ModalInput\n                  type=\"text\"\n                  placeholder=\"Enter stop code\"\n                  value={tempManualStop.code}\n                  onChange={(e) => handleManualStopModalChange('code', e.target.value)}\n                />\n              </ModalFormGroup>\n            </>\n          )}\n\n          {/* Modal Buttons */}\n          <ModalButtons>\n            <Button\n              type=\"button\"\n              variant=\"secondary\"\n              onClick={handleCancelManualStop}\n            >\n              <FiX /> Cancel\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"primary\"\n              onClick={handleConfirmManualStop}\n            >\n              <FiPlus /> Add Stop\n            </Button>\n          </ModalButtons>\n        </ModalContent>\n      </ModalOverlay>\n    </CreateRouteContainer>\n  );\n};\n\nexport default CreateRoute;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}