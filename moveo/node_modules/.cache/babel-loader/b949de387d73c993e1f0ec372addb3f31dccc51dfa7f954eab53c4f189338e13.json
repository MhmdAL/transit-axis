{"ast":null,"code":"import _taggedTemplateLiteral from\"/home/mhmdal/Projects/moveo-master/moveo/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject0,_templateObject1,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject16,_templateObject17,_templateObject18,_templateObject19,_templateObject20,_templateObject21,_templateObject22,_templateObject23,_templateObject24,_templateObject25,_templateObject26,_templateObject27,_templateObject28,_templateObject29,_templateObject30,_templateObject31,_templateObject32;import React,{useState,useEffect}from'react';import{MapContainer,TileLayer,Marker,Polyline,Popup,useMap}from'react-leaflet';import L from'leaflet';import styled from'styled-components';import{theme}from'../../styles/theme';import{RoutingService}from'../../services/routingService';// Fix for default markers in React Leaflet\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconRetinaUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',iconUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png'});// Create custom colored markers\nconst createCustomIcon=color=>{return L.divIcon({className:'custom-marker',html:\"\\n      <div style=\\\"\\n        background-color: \".concat(color,\";\\n        width: 25px;\\n        height: 25px;\\n        border-radius: 50% 50% 50% 0;\\n        border: 3px solid white;\\n        transform: rotate(-45deg);\\n        box-shadow: 0 2px 4px rgba(0,0,0,0.3);\\n        display: flex;\\n        align-items: center;\\n        justify-content: center;\\n      \\\">\\n        <div style=\\\"\\n          transform: rotate(45deg);\\n          color: white;\\n          font-weight: bold;\\n          font-size: 12px;\\n        \\\"></div>\\n      </div>\\n    \"),iconSize:[25,25],iconAnchor:[12,24],popupAnchor:[0,-24]});};// Default blue marker for available stops\nconst defaultIcon=createCustomIcon('#3b82f6');// Green marker for selected stops in route\nconst selectedIcon=createCustomIcon('#10b981');// Red marker for temporary/pending stops\nconst tempIcon=createCustomIcon('#ef4444');const MapWrapper=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: \",\";\\n  border: 2px solid \",\";\\n  border-radius: \",\";\\n  overflow: hidden;\\n  position: relative;\\n  \\n  .leaflet-container {\\n    height: 100%;\\n    width: 100%;\\n    background: \",\";\\n  }\\n  \\n  .leaflet-control-container {\\n    .leaflet-control-zoom {\\n      background: \",\";\\n      border: 1px solid \",\";\\n      \\n      a {\\n        background: \",\";\\n        color: \",\";\\n        border-bottom: 1px solid \",\";\\n        \\n        &:hover {\\n          background: \",\";\\n        }\\n        \\n        &:last-child {\\n          border-bottom: none;\\n        }\\n      }\\n    }\\n    \\n    .leaflet-control-attribution {\\n      background: rgba(0, 0, 0, 0.8);\\n      color: white;\\n      font-size: 11px;\\n      \\n      a {\\n        color: #3b82f6;\\n      }\\n    }\\n  }\\n  \\n  .leaflet-popup-content-wrapper {\\n    background: \",\";\\n    color: \",\";\\n    border-radius: \",\";\\n    box-shadow: \",\";\\n  }\\n  \\n  .leaflet-popup-tip {\\n    background: \",\";\\n  }\\n\\n  /* Custom marker styles for interactive stops */\\n  .leaflet-marker-icon {\\n    cursor: pointer;\\n    transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;\\n    \\n    &:hover {\\n      transform: scale(1.1);\\n      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));\\n    }\\n  }\\n\\n  /* Custom marker styling */\\n  .custom-marker {\\n    background: transparent !important;\\n    border: none !important;\\n  }\\n\"])),_ref=>{let{height}=_ref;return height||'500px';},theme.colors.border,theme.borderRadius.lg,theme.colors.surface,theme.colors.card,theme.colors.border,theme.colors.card,theme.colors.textPrimary,theme.colors.border,theme.colors.cardHover,theme.colors.card,theme.colors.textPrimary,theme.borderRadius.md,theme.shadows.lg,theme.colors.card);const MapSidebar=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  width: 300px;\\n  height: 100%;\\n  background: \",\";\\n  border-left: 1px solid \",\";\\n  z-index: 1000;\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n\"])),theme.colors.card,theme.colors.border);const SidebarHeader=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  padding: \",\";\\n  border-bottom: 1px solid \",\";\\n  background: \",\";\\n\"])),theme.spacing.lg,theme.colors.border,theme.colors.surface);const SidebarTitle=styled.h3(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  margin: 0;\\n  font-size: \",\";\\n  font-weight: \",\";\\n  color: \",\";\\n  display: flex;\\n  align-items: center;\\n  gap: \",\";\\n\"])),theme.typography.fontSize.lg,theme.typography.fontWeight.semibold,theme.colors.textPrimary,theme.spacing.sm);const SidebarContent=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n\"])));const ControlSection=styled.div(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  padding: \",\";\\n  border-bottom: 1px solid \",\";\\n\"])),theme.spacing.lg,theme.colors.border);const ControlGroup=styled.div(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  gap: \",\";\\n\"])),theme.spacing.md);const ToggleButton=styled.button(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  gap: \",\";\\n  padding: \",\" \",\";\\n  border: 1px solid \",\";\\n  border-radius: \",\";\\n  background: \",\";\\n  color: \",\";\\n  cursor: pointer;\\n  transition: all 0.2s ease-in-out;\\n  font-size: \",\";\\n  font-weight: \",\";\\n  \\n  &:hover {\\n    background: \",\";\\n    transform: translateY(-1px);\\n  }\\n\"])),theme.spacing.sm,theme.spacing.sm,theme.spacing.md,_ref2=>{let{active}=_ref2;return active?theme.colors.primary:theme.colors.border;},theme.borderRadius.md,_ref3=>{let{active}=_ref3;return active?theme.colors.primary:theme.colors.surface;},_ref4=>{let{active}=_ref4;return active?'white':theme.colors.textPrimary;},theme.typography.fontSize.sm,theme.typography.fontWeight.medium,_ref5=>{let{active}=_ref5;return active?theme.colors.primary:theme.colors.surfaceHover;});const ActionButton=styled.button(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  gap: \",\";\\n  padding: \",\" \",\";\\n  border: 1px solid \",\";\\n  border-radius: \",\";\\n  background: \",\";\\n  color: \",\";\\n  cursor: pointer;\\n  transition: all 0.2s ease-in-out;\\n  font-size: \",\";\\n  font-weight: \",\";\\n  \\n  &:hover {\\n    background: \",\";\\n    transform: translateY(-1px);\\n  }\\n  \\n  &:disabled {\\n    opacity: 0.5;\\n    cursor: not-allowed;\\n    transform: none;\\n  }\\n\"])),theme.spacing.sm,theme.spacing.sm,theme.spacing.md,theme.colors.border,theme.borderRadius.md,theme.colors.surface,theme.colors.textPrimary,theme.typography.fontSize.sm,theme.typography.fontWeight.medium,theme.colors.surfaceHover);const SearchSection=styled.div(_templateObject0||(_templateObject0=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  overflow: visible;\\n\"])));const SearchContainer=styled.div(_templateObject1||(_templateObject1=_taggedTemplateLiteral([\"\\n  position: relative;\\n  padding: \",\" \",\" \",\";\\n  overflow: visible;\\n\"])),theme.spacing.lg,theme.spacing.lg,theme.spacing.md);const SearchInput=styled.input(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  padding: \",\" \",\";\\n  border: 1px solid \",\";\\n  border-radius: \",\";\\n  background: \",\";\\n  color: \",\";\\n  font-size: \",\";\\n  transition: all 0.2s ease-in-out;\\n  \\n  &:focus {\\n    outline: none;\\n    border-color: \",\";\\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\\n  }\\n  \\n  &::placeholder {\\n    color: \",\";\\n  }\\n\"])),theme.spacing.sm,theme.spacing.md,theme.colors.border,theme.borderRadius.md,theme.colors.surface,theme.colors.textPrimary,theme.typography.fontSize.sm,theme.colors.primary,theme.colors.textMuted);const SearchDropdown=styled.div(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  top: 100%;\\n  left: 0;\\n  right: 0;\\n  border-top: none;\\n  border-radius: 0 0 \",\" \",\";\\n  box-shadow: \",\";\\n  z-index: 1000;\\n  max-height: 200px;\\n  min-height: 40px;\\n  overflow-y: auto;\\n  display: \",\";\\n  transition: all 0.2s ease-in-out;\\n\"])),theme.borderRadius.md,theme.borderRadius.md,theme.shadows.lg,_ref6=>{let{isOpen}=_ref6;return isOpen?'block':'none';});const DropdownItem=styled.div(_templateObject12||(_templateObject12=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  padding: \",\" \",\";\\n  cursor: pointer;\\n  transition: all 0.2s ease-in-out;\\n  border-bottom: 1px solid \",\";\\n  \\n  background: \",\";\\n    \\n  &:hover {\\n    background: \",\";\\n  }\\n  \\n  &:last-child {\\n    border-bottom: none;\\n  }\\n\"])),theme.spacing.sm,theme.spacing.md,theme.colors.border,theme.colors.surface,theme.colors.surfaceHover);const DropdownItemInfo=styled.div(_templateObject13||(_templateObject13=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  min-width: 0;\\n\"])));const DropdownItemName=styled.div(_templateObject14||(_templateObject14=_taggedTemplateLiteral([\"\\n  font-weight: \",\";\\n  color: inherit;\\n  font-size: \",\";\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n\"])),theme.typography.fontWeight.medium,theme.typography.fontSize.sm);const DropdownItemCode=styled.div(_templateObject15||(_templateObject15=_taggedTemplateLiteral([\"\\n  color: \",\";\\n  font-size: \",\";\\n  margin-top: \",\";\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n\"])),theme.colors.textSecondary,theme.typography.fontSize.xs,theme.spacing.xs);const NoResults=styled.div(_templateObject16||(_templateObject16=_taggedTemplateLiteral([\"\\n  padding: \",\";\\n  text-align: center;\\n  color: \",\";\\n  font-size: \",\";\\n\"])),theme.spacing.md,theme.colors.textMuted,theme.typography.fontSize.sm);const SelectedStopsSection=styled.div(_templateObject17||(_templateObject17=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n\"])));const SelectedStopsHeader=styled.div(_templateObject18||(_templateObject18=_taggedTemplateLiteral([\"\\n  padding: 0 \",\" \",\";\\n  font-size: \",\";\\n  font-weight: \",\";\\n  color: \",\";\\n\"])),theme.spacing.lg,theme.spacing.sm,theme.typography.fontSize.sm,theme.typography.fontWeight.medium,theme.colors.textSecondary);const SelectedStopsList=styled.div(_templateObject19||(_templateObject19=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  overflow-y: auto;\\n  padding: \",\" \",\";\\n\"])),theme.spacing.md,theme.spacing.lg);const SelectedStopItem=styled.div(_templateObject20||(_templateObject20=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  gap: \",\";\\n  padding: \",\" \",\";\\n  margin-bottom: \",\";\\n  background: \",\";\\n  border: 1px solid \",\";\\n  border-radius: \",\";\\n  transition: all 0.2s ease-in-out;\\n  \\n  &:hover {\\n    background: \",\";\\n    transform: translateY(-1px);\\n    box-shadow: \",\";\\n  }\\n\"])),theme.spacing.sm,theme.spacing.sm,theme.spacing.md,theme.spacing.xs,theme.colors.surface,theme.colors.border,theme.borderRadius.md,theme.colors.surfaceHover,theme.shadows.sm);const StopOrder=styled.div(_templateObject21||(_templateObject21=_taggedTemplateLiteral([\"\\n  width: 24px;\\n  height: 24px;\\n  border-radius: 50%;\\n  background: \",\";\\n  color: white;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  font-weight: \",\";\\n  font-size: \",\";\\n  flex-shrink: 0;\\n\"])),theme.colors.primary,theme.typography.fontWeight.bold,theme.typography.fontSize.xs);const StopInfo=styled.div(_templateObject22||(_templateObject22=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  min-width: 0;\\n\"])));const StopName=styled.div(_templateObject23||(_templateObject23=_taggedTemplateLiteral([\"\\n  font-weight: \",\";\\n  color: \",\";\\n  font-size: \",\";\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n\"])),theme.typography.fontWeight.medium,theme.colors.textPrimary,theme.typography.fontSize.sm);const StopCode=styled.div(_templateObject24||(_templateObject24=_taggedTemplateLiteral([\"\\n  color: \",\";\\n  font-size: \",\";\\n  margin-top: \",\";\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n\"])),theme.colors.textSecondary,theme.typography.fontSize.xs,theme.spacing.xs);const RemoveButton=styled.button(_templateObject25||(_templateObject25=_taggedTemplateLiteral([\"\\n  color: \",\";\\n  padding: \",\";\\n  border-radius: \",\";\\n  transition: all 0.2s ease-in-out;\\n  \\n  &:hover {\\n    background: rgba(239, 68, 68, 0.1);\\n    transform: scale(1.1);\\n  }\\n\"])),theme.colors.error,theme.spacing.xs,theme.borderRadius.sm);const EmptyState=styled.div(_templateObject26||(_templateObject26=_taggedTemplateLiteral([\"\\n  text-align: center;\\n  padding: \",\";\\n  color: \",\";\\n\"])),theme.spacing.xl,theme.colors.textMuted);const MapInfo=styled.div(_templateObject27||(_templateObject27=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  top: \",\";\\n  left: \",\";\\n  background: rgba(0, 0, 0, 0.8);\\n  color: white;\\n  padding: \",\" \",\";\\n  border-radius: \",\";\\n  font-size: \",\";\\n  z-index: 1000;\\n  pointer-events: none;\\n  max-width: 250px;\\n\"])),theme.spacing.md,theme.spacing.md,theme.spacing.sm,theme.spacing.md,theme.borderRadius.md,theme.typography.fontSize.sm);const RouteInfo=styled.div(_templateObject28||(_templateObject28=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  top: \",\";\\n  right: \",\";\\n  background: rgba(0, 0, 0, 0.8);\\n  color: white;\\n  padding: \",\" \",\";\\n  border-radius: \",\";\\n  font-size: \",\";\\n  z-index: 1000;\\n  pointer-events: none;\\n  min-width: 150px;\\n\"])),theme.spacing.md,theme.spacing.md,theme.spacing.sm,theme.spacing.md,theme.borderRadius.md,theme.typography.fontSize.sm);const RouteInfoItem=styled.div(_templateObject29||(_templateObject29=_taggedTemplateLiteral([\"\\n  margin: 2px 0;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  gap: \",\";\\n\"])),theme.spacing.sm);const PopupContent=styled.div(_templateObject30||(_templateObject30=_taggedTemplateLiteral([\"\\n  min-width: 200px;\\n\"])));const PopupTitle=styled.h4(_templateObject31||(_templateObject31=_taggedTemplateLiteral([\"\\n  margin: 0 0 \",\" 0;\\n  color: \",\";\\n  font-size: \",\";\\n\"])),theme.spacing.sm,theme.colors.textPrimary,theme.typography.fontSize.sm);const PopupDetail=styled.div(_templateObject32||(_templateObject32=_taggedTemplateLiteral([\"\\n  margin: \",\" 0;\\n  font-size: \",\";\\n  color: \",\";\\n\"])),theme.spacing.xs,theme.typography.fontSize.xs,theme.colors.textSecondary);// Component to fit all available stops into view\nconst FitAllStopsHandler=_ref7=>{let{stops}=_ref7;const map=useMap();useEffect(()=>{if(stops.length===0)return;try{// Create bounds from all stops - convert string coords to numbers\nconst bounds=L.latLngBounds(stops.map(stop=>[parseFloat(stop.location.lat.toString()),parseFloat(stop.location.lon.toString())]));// Fit the map to show all stops\nmap.fitBounds(bounds,{padding:[50,50],maxZoom:16});}catch(error){console.error('Error fitting stops to view:',error);}},[map,stops.length]);return null;};// Component to handle map bounds fitting\nconst MapBoundsHandler=_ref8=>{let{selectedStops}=_ref8;const map=useMap();useEffect(()=>{if(selectedStops.length>0){// Create bounds from selected stops - convert string coords to numbers\nconst bounds=L.latLngBounds(selectedStops.map(stop=>[parseFloat(stop.location.lat.toString()),parseFloat(stop.location.lon.toString())]));// Fit the map to show all selected stops with some padding\nif(selectedStops.length===1){// For single stop, just center on it with a reasonable zoom\nconst lat=parseFloat(selectedStops[0].location.lat.toString());const lon=parseFloat(selectedStops[0].location.lon.toString());map.setView([lat,lon],14);}else{// For multiple stops, fit bounds with padding\nmap.fitBounds(bounds,{padding:[20,20],maxZoom:16});}}},[map,selectedStops]);return null;};// Component to handle map clicks for manual stop addition\nconst MapClickHandler=_ref9=>{let{onMapClick,isManualAddMode=false}=_ref9;const map=useMap();useEffect(()=>{console.log('ðŸ–±ï¸ MapClickHandler Setup:',{isManualAddMode,hasCallback:!!onMapClick});if(!isManualAddMode||!onMapClick){console.log('â­ï¸ MapClickHandler - mode disabled or no callback');return;}const handleClick=e=>{var _e$latlng,_e$latlng2;console.log('ðŸŽ¯ MAP CLICKED event:',e);const lat=(_e$latlng=e.latlng)===null||_e$latlng===void 0?void 0:_e$latlng.lat;const lng=(_e$latlng2=e.latlng)===null||_e$latlng2===void 0?void 0:_e$latlng2.lng;console.log('ðŸŽ¯ MAP CLICKED at:',{lat,lng,isManualAddMode});if(lat!==undefined&&lng!==undefined){onMapClick(lat,lng);}};console.log('âœ… Attaching click handler to map');// Try both methods\nmap.on('click',handleClick);return()=>{console.log('âŒ Detaching click handler');map.off('click',handleClick);};},[map,onMapClick,isManualAddMode]);return null;};const RouteMap=_ref0=>{let{stops,selectedStops,center,zoom=12,showRoute=true,height,onStopClick,onFitRoute,showAllStops=true,onToggleShowAllStops,searchTerm='',onSearchChange,filteredStops=[],onAddStop,onRemoveStop,onMapClick,isManualAddMode=false,onToggleManualMode,tempMarker}=_ref0;// Default center - Qatar (Doha) if no center provided\nconst defaultCenter=center||{lat:25.2854,lng:51.5310};// State for route data\nconst[routeData,setRouteData]=useState(null);const[isCalculatingRoute,setIsCalculatingRoute]=useState(false);const[isSearchDropdownOpen,setIsSearchDropdownOpen]=useState(false);// Debug: Log stops and manual mode\nuseEffect(()=>{console.log('RouteMap Debug:',{stopsCount:stops.length,selectedStopsCount:selectedStops.length,isManualAddMode,showAllStops,defaultCenter,stopsArray:stops.slice(0,3)// First 3 stops\n});},[stops.length,selectedStops.length,isManualAddMode,showAllStops,defaultCenter]);// Calculate route when selected stops change\nuseEffect(()=>{// Create an AbortController for this effect\nconst abortController=new AbortController();let timeoutId;if(selectedStops.length>=2&&showRoute){setIsCalculatingRoute(true);const waypoints=selectedStops.map(stop=>({lat:parseFloat(stop.location.lat.toString()),lng:parseFloat(stop.location.lon.toString())}));// Create a stable key for this route calculation\n//   const routeKey = waypoints.map(w => `${w.lat.toFixed(6)},${w.lng.toFixed(6)}`).join('|');\n// Add a longer delay to avoid excessive API calls during hot reload\ntimeoutId=setTimeout(async()=>{// Check if component is still mounted and request not aborted\nif(abortController.signal.aborted){return;}try{const route=await RoutingService.calculateRoute(waypoints,abortController.signal);// Check again if component is still mounted\nif(!abortController.signal.aborted){setRouteData(route);setIsCalculatingRoute(false);}}catch(error){// Only handle error if not aborted\nif(!abortController.signal.aborted){console.error('Failed to calculate route:',error);setIsCalculatingRoute(false);// Fallback to straight line\nsetRouteData({coordinates:waypoints,distance:0,duration:0});}}},1000);// Increased to 1 second to reduce hot reload requests\n}else{setRouteData(null);setIsCalculatingRoute(false);}// Cleanup function\nreturn()=>{abortController.abort();if(timeoutId){clearTimeout(timeoutId);}};},[selectedStops,showRoute]);// Create route line coordinates for Leaflet Polyline\nconst routeCoordinates=routeData?routeData.coordinates.map(coord=>[coord.lat,coord.lng]):selectedStops.map(stop=>[stop.location.lat,stop.location.lon]);// Search handlers\nconst handleSearchChange=value=>{onSearchChange===null||onSearchChange===void 0?void 0:onSearchChange(value);const shouldOpen=value.length>0;console.log('Search change:',value,'Should open:',shouldOpen,'Filtered stops:',filteredStops.length);setIsSearchDropdownOpen(shouldOpen);};const handleSearchFocus=()=>{console.log('Search focus, searchTerm:',searchTerm,'length:',searchTerm.length);if(searchTerm.length>0){setIsSearchDropdownOpen(true);}};const handleSearchBlur=()=>{// Delay closing to allow for click on dropdown item\nsetTimeout(()=>{setIsSearchDropdownOpen(false);},200);};const handleDropdownItemClick=stop=>{onAddStop===null||onAddStop===void 0?void 0:onAddStop(stop);onSearchChange===null||onSearchChange===void 0?void 0:onSearchChange('');setIsSearchDropdownOpen(false);};return/*#__PURE__*/_jsxs(MapWrapper,{children:[onStopClick&&/*#__PURE__*/_jsxs(MapInfo,{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',opacity:0.8},children:\"\\uD83D\\uDCCD Click stops to add to route\"}),isCalculatingRoute&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'4px',fontSize:'12px',opacity:0.8,color:'#3b82f6'},children:\"\\uD83D\\uDEE3\\uFE0F Calculating road route...\"}),selectedStops.length===1&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'4px',fontSize:'12px',opacity:0.8},children:\"Add another stop to see route\"})]}),/*#__PURE__*/_jsxs(MapSidebar,{children:[/*#__PURE__*/_jsx(SidebarHeader,{children:/*#__PURE__*/_jsx(SidebarTitle,{children:\"\\uD83D\\uDDFA\\uFE0F Route Builder\"})}),/*#__PURE__*/_jsxs(SidebarContent,{children:[/*#__PURE__*/_jsx(ControlSection,{children:/*#__PURE__*/_jsxs(ControlGroup,{children:[onToggleShowAllStops&&/*#__PURE__*/_jsxs(ToggleButton,{active:showAllStops,onClick:onToggleShowAllStops,children:[\"\\uD83D\\uDCCD \",showAllStops?'Hide All Stops':'Show All Stops']}),onToggleManualMode&&/*#__PURE__*/_jsxs(ToggleButton,{active:isManualAddMode,onClick:onToggleManualMode,children:[\"\\uD83D\\uDCCC \",isManualAddMode?'Stop Placement Mode':'Click to Add Stops']}),selectedStops.length>=2&&onFitRoute&&/*#__PURE__*/_jsx(ActionButton,{onClick:onFitRoute,children:\"\\uD83C\\uDFAF Fit Route to View\"})]})}),/*#__PURE__*/_jsx(SearchSection,{children:/*#__PURE__*/_jsxs(SearchContainer,{children:[/*#__PURE__*/_jsx(SearchInput,{type:\"text\",placeholder:\"Search stops to add...\",value:searchTerm,onChange:e=>handleSearchChange(e.target.value),onFocus:handleSearchFocus,onBlur:handleSearchBlur}),/*#__PURE__*/_jsx(SearchDropdown,{isOpen:isSearchDropdownOpen,children:filteredStops.length>0?filteredStops.map(stop=>{const isSelected=selectedStops.some(s=>s.id===stop.id);return/*#__PURE__*/_jsxs(DropdownItem,{selected:isSelected,onClick:()=>!isSelected&&handleDropdownItemClick(stop),children:[/*#__PURE__*/_jsxs(DropdownItemInfo,{children:[/*#__PURE__*/_jsx(DropdownItemName,{children:stop.name}),/*#__PURE__*/_jsx(DropdownItemCode,{children:stop.code})]}),!isSelected&&/*#__PURE__*/_jsx(\"div\",{style:{color:theme.colors.primary,fontSize:'16px'},children:\"+\"})]},stop.id);}):/*#__PURE__*/_jsxs(NoResults,{children:[\"No stops found for \\\"\",searchTerm,\"\\\"\"]})})]})}),/*#__PURE__*/_jsxs(SelectedStopsSection,{children:[/*#__PURE__*/_jsxs(SelectedStopsHeader,{children:[\"Selected Stops (\",selectedStops.length,\")\"]}),/*#__PURE__*/_jsx(SelectedStopsList,{children:selectedStops.length>0?selectedStops.map((stop,index)=>/*#__PURE__*/_jsxs(SelectedStopItem,{children:[/*#__PURE__*/_jsx(StopOrder,{children:index+1}),/*#__PURE__*/_jsxs(StopInfo,{children:[/*#__PURE__*/_jsx(StopName,{children:stop.name}),/*#__PURE__*/_jsx(StopCode,{children:stop.code})]}),/*#__PURE__*/_jsx(RemoveButton,{onClick:()=>onRemoveStop===null||onRemoveStop===void 0?void 0:onRemoveStop(stop.id),children:\"\\xD7\"})]},stop.id)):/*#__PURE__*/_jsxs(EmptyState,{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'20px',marginBottom:'8px'},children:\"\\uD83D\\uDCCD\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',fontWeight:'500'},children:\"No stops selected\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'10px',marginTop:'4px',color:theme.colors.textMuted},children:\"Search and add stops to build your route\"})]})})]})]})]}),/*#__PURE__*/_jsxs(MapContainer,{center:[defaultCenter.lat,defaultCenter.lng],zoom:zoom,style:{height:'100%',width:'100%'},children:[/*#__PURE__*/_jsx(TileLayer,{attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\",url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}),/*#__PURE__*/_jsx(MapBoundsHandler,{selectedStops:selectedStops}),/*#__PURE__*/_jsx(FitAllStopsHandler,{stops:stops}),/*#__PURE__*/_jsx(MapClickHandler,{onMapClick:onMapClick,isManualAddMode:isManualAddMode}),(()=>{console.log('ðŸ—ºï¸ MAP RENDERING:',{stopsLength:stops.length,showAllStops});const markers=stops.map(stop=>{const isSelected=selectedStops.some(s=>s.id===stop.id);const selectedIndex=selectedStops.findIndex(s=>s.id===stop.id);// Only show non-selected stops if showAllStops is true\nif(!isSelected&&!showAllStops){console.log('â­ï¸ SKIPPING STOP:',stop.name,'(not selected & showAllStops is false)');return null;}const lat=parseFloat(stop.location.lat.toString());const lon=parseFloat(stop.location.lon.toString());console.log('ðŸ“ MARKER RENDER:',{name:stop.name,lat,lon,isSelected});return/*#__PURE__*/_jsx(Marker,{position:[lat,lon],icon:isSelected?selectedIcon:defaultIcon,eventHandlers:{click:()=>{if(onStopClick){onStopClick(stop);}}},children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsxs(PopupContent,{children:[/*#__PURE__*/_jsx(PopupTitle,{children:stop.name}),/*#__PURE__*/_jsxs(PopupDetail,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Code:\"}),\" \",stop.code]}),isSelected&&/*#__PURE__*/_jsxs(PopupDetail,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Order:\"}),\" #\",selectedIndex+1,\" in route\"]}),onStopClick&&!isSelected&&/*#__PURE__*/_jsx(PopupDetail,{style:{color:theme.colors.primary,fontWeight:'bold',marginTop:'8px'},children:\"Click to add to route\"})]})})},stop.id);});console.log('ðŸŽ¨ TOTAL MARKERS RENDERED:',markers.filter(m=>m!==null).length);return markers;})(),(()=>{console.log('ðŸ”´ TEMP MARKER CHECK:',{tempMarker,isManualAddMode,shouldRender:tempMarker&&isManualAddMode});if(tempMarker&&isManualAddMode){const lat=parseFloat(tempMarker.lat.toString());const lon=parseFloat(tempMarker.lon.toString());console.log('ðŸ”´ RENDERING TEMP MARKER at:',{lat,lon});return/*#__PURE__*/_jsx(Marker,{position:[lat,lon],icon:tempIcon,children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsxs(PopupContent,{children:[/*#__PURE__*/_jsx(PopupTitle,{children:\"New Stop Location\"}),/*#__PURE__*/_jsxs(PopupDetail,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Lat:\"}),\" \",lat.toFixed(6)]}),/*#__PURE__*/_jsxs(PopupDetail,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Lon:\"}),\" \",lon.toFixed(6)]})]})})});}return null;})(),showRoute&&selectedStops.length>1&&routeCoordinates.length>0&&/*#__PURE__*/_jsx(Polyline,{positions:routeCoordinates,color:routeData?theme.colors.primary:theme.colors.secondary,weight:routeData?5:4,opacity:routeData?0.9:0.6,dashArray:routeData?undefined:\"10, 5\"})]})]});};export default RouteMap;","map":{"version":3,"names":["React","useState","useEffect","MapContainer","TileLayer","Marker","Polyline","Popup","useMap","L","styled","theme","RoutingService","jsx","_jsx","jsxs","_jsxs","Icon","Default","prototype","_getIconUrl","mergeOptions","iconRetinaUrl","iconUrl","shadowUrl","createCustomIcon","color","divIcon","className","html","concat","iconSize","iconAnchor","popupAnchor","defaultIcon","selectedIcon","tempIcon","MapWrapper","div","_templateObject","_taggedTemplateLiteral","_ref","height","colors","border","borderRadius","lg","surface","card","textPrimary","cardHover","md","shadows","MapSidebar","_templateObject2","SidebarHeader","_templateObject3","spacing","SidebarTitle","h3","_templateObject4","typography","fontSize","fontWeight","semibold","sm","SidebarContent","_templateObject5","ControlSection","_templateObject6","ControlGroup","_templateObject7","ToggleButton","button","_templateObject8","_ref2","active","primary","_ref3","_ref4","medium","_ref5","surfaceHover","ActionButton","_templateObject9","SearchSection","_templateObject0","SearchContainer","_templateObject1","SearchInput","input","_templateObject10","textMuted","SearchDropdown","_templateObject11","_ref6","isOpen","DropdownItem","_templateObject12","DropdownItemInfo","_templateObject13","DropdownItemName","_templateObject14","DropdownItemCode","_templateObject15","textSecondary","xs","NoResults","_templateObject16","SelectedStopsSection","_templateObject17","SelectedStopsHeader","_templateObject18","SelectedStopsList","_templateObject19","SelectedStopItem","_templateObject20","StopOrder","_templateObject21","bold","StopInfo","_templateObject22","StopName","_templateObject23","StopCode","_templateObject24","RemoveButton","_templateObject25","error","EmptyState","_templateObject26","xl","MapInfo","_templateObject27","RouteInfo","_templateObject28","RouteInfoItem","_templateObject29","PopupContent","_templateObject30","PopupTitle","h4","_templateObject31","PopupDetail","_templateObject32","FitAllStopsHandler","_ref7","stops","map","length","bounds","latLngBounds","stop","parseFloat","location","lat","toString","lon","fitBounds","padding","maxZoom","console","MapBoundsHandler","_ref8","selectedStops","setView","MapClickHandler","_ref9","onMapClick","isManualAddMode","log","hasCallback","handleClick","e","_e$latlng","_e$latlng2","latlng","lng","undefined","on","off","RouteMap","_ref0","center","zoom","showRoute","onStopClick","onFitRoute","showAllStops","onToggleShowAllStops","searchTerm","onSearchChange","filteredStops","onAddStop","onRemoveStop","onToggleManualMode","tempMarker","defaultCenter","routeData","setRouteData","isCalculatingRoute","setIsCalculatingRoute","isSearchDropdownOpen","setIsSearchDropdownOpen","stopsCount","selectedStopsCount","stopsArray","slice","abortController","AbortController","timeoutId","waypoints","setTimeout","signal","aborted","route","calculateRoute","coordinates","distance","duration","abort","clearTimeout","routeCoordinates","coord","handleSearchChange","value","shouldOpen","handleSearchFocus","handleSearchBlur","handleDropdownItemClick","children","style","opacity","marginTop","onClick","type","placeholder","onChange","target","onFocus","onBlur","isSelected","some","s","id","selected","name","code","index","marginBottom","width","attribution","url","stopsLength","markers","selectedIndex","findIndex","position","icon","eventHandlers","click","filter","m","shouldRender","toFixed","positions","secondary","weight","dashArray"],"sources":["/home/mhmdal/Projects/moveo-master/moveo/src/components/Map/RouteMap.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { MapContainer, TileLayer, Marker, Polyline, Popup, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport styled from 'styled-components';\nimport { theme } from '../../styles/theme';\nimport { Stop } from '../../types';\nimport { RoutingService, RouteResponse, RouteCoordinate } from '../../services/routingService';\n\n// Fix for default markers in React Leaflet\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n});\n\n// Create custom colored markers\nconst createCustomIcon = (color: string) => {\n  return L.divIcon({\n    className: 'custom-marker',\n    html: `\n      <div style=\"\n        background-color: ${color};\n        width: 25px;\n        height: 25px;\n        border-radius: 50% 50% 50% 0;\n        border: 3px solid white;\n        transform: rotate(-45deg);\n        box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      \">\n        <div style=\"\n          transform: rotate(45deg);\n          color: white;\n          font-weight: bold;\n          font-size: 12px;\n        \"></div>\n      </div>\n    `,\n    iconSize: [25, 25],\n    iconAnchor: [12, 24],\n    popupAnchor: [0, -24]\n  });\n};\n\n// Default blue marker for available stops\nconst defaultIcon = createCustomIcon('#3b82f6');\n\n// Green marker for selected stops in route\nconst selectedIcon = createCustomIcon('#10b981');\n\n// Red marker for temporary/pending stops\nconst tempIcon = createCustomIcon('#ef4444');\n\nconst MapWrapper = styled.div<{ height?: string }>`\n  width: 100%;\n  height: ${({ height }) => height || '500px'};\n  border: 2px solid ${theme.colors.border};\n  border-radius: ${theme.borderRadius.lg};\n  overflow: hidden;\n  position: relative;\n  \n  .leaflet-container {\n    height: 100%;\n    width: 100%;\n    background: ${theme.colors.surface};\n  }\n  \n  .leaflet-control-container {\n    .leaflet-control-zoom {\n      background: ${theme.colors.card};\n      border: 1px solid ${theme.colors.border};\n      \n      a {\n        background: ${theme.colors.card};\n        color: ${theme.colors.textPrimary};\n        border-bottom: 1px solid ${theme.colors.border};\n        \n        &:hover {\n          background: ${theme.colors.cardHover};\n        }\n        \n        &:last-child {\n          border-bottom: none;\n        }\n      }\n    }\n    \n    .leaflet-control-attribution {\n      background: rgba(0, 0, 0, 0.8);\n      color: white;\n      font-size: 11px;\n      \n      a {\n        color: #3b82f6;\n      }\n    }\n  }\n  \n  .leaflet-popup-content-wrapper {\n    background: ${theme.colors.card};\n    color: ${theme.colors.textPrimary};\n    border-radius: ${theme.borderRadius.md};\n    box-shadow: ${theme.shadows.lg};\n  }\n  \n  .leaflet-popup-tip {\n    background: ${theme.colors.card};\n  }\n\n  /* Custom marker styles for interactive stops */\n  .leaflet-marker-icon {\n    cursor: pointer;\n    transition: transform 0.2s ease-in-out, filter 0.2s ease-in-out;\n    \n    &:hover {\n      transform: scale(1.1);\n      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));\n    }\n  }\n\n  /* Custom marker styling */\n  .custom-marker {\n    background: transparent !important;\n    border: none !important;\n  }\n`;\n\nconst MapSidebar = styled.div`\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 300px;\n  height: 100%;\n  background: ${theme.colors.card};\n  border-left: 1px solid ${theme.colors.border};\n  z-index: 1000;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n`;\n\nconst SidebarHeader = styled.div`\n  padding: ${theme.spacing.lg};\n  border-bottom: 1px solid ${theme.colors.border};\n  background: ${theme.colors.surface};\n`;\n\nconst SidebarTitle = styled.h3`\n  margin: 0;\n  font-size: ${theme.typography.fontSize.lg};\n  font-weight: ${theme.typography.fontWeight.semibold};\n  color: ${theme.colors.textPrimary};\n  display: flex;\n  align-items: center;\n  gap: ${theme.spacing.sm};\n`;\n\nconst SidebarContent = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n`;\n\nconst ControlSection = styled.div`\n  padding: ${theme.spacing.lg};\n  border-bottom: 1px solid ${theme.colors.border};\n`;\n\nconst ControlGroup = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: ${theme.spacing.md};\n`;\n\nconst ToggleButton = styled.button<{ active: boolean }>`\n  display: flex;\n  align-items: center;\n  gap: ${theme.spacing.sm};\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  border: 1px solid ${({ active }) => active ? theme.colors.primary : theme.colors.border};\n  border-radius: ${theme.borderRadius.md};\n  background: ${({ active }) => active ? theme.colors.primary : theme.colors.surface};\n  color: ${({ active }) => active ? 'white' : theme.colors.textPrimary};\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  \n  &:hover {\n    background: ${({ active }) => active ? theme.colors.primary : theme.colors.surfaceHover};\n    transform: translateY(-1px);\n  }\n`;\n\nconst ActionButton = styled.button`\n  display: flex;\n  align-items: center;\n  gap: ${theme.spacing.sm};\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  border: 1px solid ${theme.colors.border};\n  border-radius: ${theme.borderRadius.md};\n  background: ${theme.colors.surface};\n  color: ${theme.colors.textPrimary};\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  \n  &:hover {\n    background: ${theme.colors.surfaceHover};\n    transform: translateY(-1px);\n  }\n  \n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n\nconst SearchSection = styled.div`\n  display: flex;\n  flex-direction: column;\n  overflow: visible;\n`;\n\nconst SearchContainer = styled.div`\n  position: relative;\n  padding: ${theme.spacing.lg} ${theme.spacing.lg} ${theme.spacing.md};\n  overflow: visible;\n`;\n\nconst SearchInput = styled.input`\n  width: 100%;\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  border: 1px solid ${theme.colors.border};\n  border-radius: ${theme.borderRadius.md};\n  background: ${theme.colors.surface};\n  color: ${theme.colors.textPrimary};\n  font-size: ${theme.typography.fontSize.sm};\n  transition: all 0.2s ease-in-out;\n  \n  &:focus {\n    outline: none;\n    border-color: ${theme.colors.primary};\n    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n  }\n  \n  &::placeholder {\n    color: ${theme.colors.textMuted};\n  }\n`;\n\nconst SearchDropdown = styled.div<{ isOpen: boolean }>`\n  position: absolute;\n  top: 100%;\n  left: 0;\n  right: 0;\n  border-top: none;\n  border-radius: 0 0 ${theme.borderRadius.md} ${theme.borderRadius.md};\n  box-shadow: ${theme.shadows.lg};\n  z-index: 1000;\n  max-height: 200px;\n  min-height: 40px;\n  overflow-y: auto;\n  display: ${({ isOpen }) => isOpen ? 'block' : 'none'};\n  transition: all 0.2s ease-in-out;\n`;\n\nconst DropdownItem = styled.div<{ selected?: boolean }>`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  border-bottom: 1px solid ${theme.colors.border};\n  \n  background: ${theme.colors.surface};\n    \n  &:hover {\n    background: ${theme.colors.surfaceHover};\n  }\n  \n  &:last-child {\n    border-bottom: none;\n  }\n`;\n\nconst DropdownItemInfo = styled.div`\n  flex: 1;\n  min-width: 0;\n`;\n\nconst DropdownItemName = styled.div`\n  font-weight: ${theme.typography.fontWeight.medium};\n  color: inherit;\n  font-size: ${theme.typography.fontSize.sm};\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst DropdownItemCode = styled.div`\n  color: ${theme.colors.textSecondary};\n  font-size: ${theme.typography.fontSize.xs};\n  margin-top: ${theme.spacing.xs};\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst NoResults = styled.div`\n  padding: ${theme.spacing.md};\n  text-align: center;\n  color: ${theme.colors.textMuted};\n  font-size: ${theme.typography.fontSize.sm};\n`;\n\nconst SelectedStopsSection = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n`;\n\nconst SelectedStopsHeader = styled.div`\n  padding: 0 ${theme.spacing.lg} ${theme.spacing.sm};\n  font-size: ${theme.typography.fontSize.sm};\n  font-weight: ${theme.typography.fontWeight.medium};\n  color: ${theme.colors.textSecondary};\n`;\n\nconst SelectedStopsList = styled.div`\n  flex: 1;\n  overflow-y: auto;\n  padding: ${theme.spacing.md} ${theme.spacing.lg};\n`;\n\nconst SelectedStopItem = styled.div`\n  display: flex;\n  align-items: center;\n  gap: ${theme.spacing.sm};\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  margin-bottom: ${theme.spacing.xs};\n  background: ${theme.colors.surface};\n  border: 1px solid ${theme.colors.border};\n  border-radius: ${theme.borderRadius.md};\n  transition: all 0.2s ease-in-out;\n  \n  &:hover {\n    background: ${theme.colors.surfaceHover};\n    transform: translateY(-1px);\n    box-shadow: ${theme.shadows.sm};\n  }\n`;\n\nconst StopOrder = styled.div`\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  background: ${theme.colors.primary};\n  color: white;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: ${theme.typography.fontWeight.bold};\n  font-size: ${theme.typography.fontSize.xs};\n  flex-shrink: 0;\n`;\n\nconst StopInfo = styled.div`\n  flex: 1;\n  min-width: 0;\n`;\n\nconst StopName = styled.div`\n  font-weight: ${theme.typography.fontWeight.medium};\n  color: ${theme.colors.textPrimary};\n  font-size: ${theme.typography.fontSize.sm};\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst StopCode = styled.div`\n  color: ${theme.colors.textSecondary};\n  font-size: ${theme.typography.fontSize.xs};\n  margin-top: ${theme.spacing.xs};\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nconst RemoveButton = styled.button`\n  color: ${theme.colors.error};\n  padding: ${theme.spacing.xs};\n  border-radius: ${theme.borderRadius.sm};\n  transition: all 0.2s ease-in-out;\n  \n  &:hover {\n    background: rgba(239, 68, 68, 0.1);\n    transform: scale(1.1);\n  }\n`;\n\nconst EmptyState = styled.div`\n  text-align: center;\n  padding: ${theme.spacing.xl};\n  color: ${theme.colors.textMuted};\n`;\n\nconst MapInfo = styled.div`\n  position: absolute;\n  top: ${theme.spacing.md};\n  left: ${theme.spacing.md};\n  background: rgba(0, 0, 0, 0.8);\n  color: white;\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  border-radius: ${theme.borderRadius.md};\n  font-size: ${theme.typography.fontSize.sm};\n  z-index: 1000;\n  pointer-events: none;\n  max-width: 250px;\n`;\n\nconst RouteInfo = styled.div`\n  position: absolute;\n  top: ${theme.spacing.md};\n  right: ${theme.spacing.md};\n  background: rgba(0, 0, 0, 0.8);\n  color: white;\n  padding: ${theme.spacing.sm} ${theme.spacing.md};\n  border-radius: ${theme.borderRadius.md};\n  font-size: ${theme.typography.fontSize.sm};\n  z-index: 1000;\n  pointer-events: none;\n  min-width: 150px;\n`;\n\nconst RouteInfoItem = styled.div`\n  margin: 2px 0;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: ${theme.spacing.sm};\n`;\n\nconst PopupContent = styled.div`\n  min-width: 200px;\n`;\n\nconst PopupTitle = styled.h4`\n  margin: 0 0 ${theme.spacing.sm} 0;\n  color: ${theme.colors.textPrimary};\n  font-size: ${theme.typography.fontSize.sm};\n`;\n\nconst PopupDetail = styled.div`\n  margin: ${theme.spacing.xs} 0;\n  font-size: ${theme.typography.fontSize.xs};\n  color: ${theme.colors.textSecondary};\n`;\n\n// Component to fit all available stops into view\nconst FitAllStopsHandler: React.FC<{ stops: Stop[] }> = ({ stops }) => {\n  const map = useMap();\n\n  useEffect(() => {\n    if (stops.length === 0) return;\n\n    try {\n      // Create bounds from all stops - convert string coords to numbers\n      const bounds = L.latLngBounds(\n        stops.map(stop => [parseFloat(stop.location.lat.toString()), parseFloat(stop.location.lon.toString())])\n      );\n\n      // Fit the map to show all stops\n      map.fitBounds(bounds, {\n        padding: [50, 50],\n        maxZoom: 16\n      });\n    } catch (error) {\n      console.error('Error fitting stops to view:', error);\n    }\n  }, [map, stops.length]);\n\n  return null;\n};\n\n// Component to handle map bounds fitting\nconst MapBoundsHandler: React.FC<{ selectedStops: Stop[] }> = ({ selectedStops }) => {\n  const map = useMap();\n\n  useEffect(() => {\n    if (selectedStops.length > 0) {\n      // Create bounds from selected stops - convert string coords to numbers\n      const bounds = L.latLngBounds(\n        selectedStops.map(stop => [parseFloat(stop.location.lat.toString()), parseFloat(stop.location.lon.toString())])\n      );\n\n      // Fit the map to show all selected stops with some padding\n      if (selectedStops.length === 1) {\n        // For single stop, just center on it with a reasonable zoom\n        const lat = parseFloat(selectedStops[0].location.lat.toString());\n        const lon = parseFloat(selectedStops[0].location.lon.toString());\n        map.setView([lat, lon], 14);\n      } else {\n        // For multiple stops, fit bounds with padding\n        map.fitBounds(bounds, { \n          padding: [20, 20],\n          maxZoom: 16 \n        });\n      }\n    }\n  }, [map, selectedStops]);\n\n  return null;\n};\n\n// Component to handle map clicks for manual stop addition\nconst MapClickHandler: React.FC<{ onMapClick?: (lat: number, lon: number) => void; isManualAddMode?: boolean }> = ({ \n  onMapClick, \n  isManualAddMode = false \n}) => {\n  const map = useMap();\n\n  useEffect(() => {\n    console.log('ðŸ–±ï¸ MapClickHandler Setup:', { isManualAddMode, hasCallback: !!onMapClick });\n    \n    if (!isManualAddMode || !onMapClick) {\n      console.log('â­ï¸ MapClickHandler - mode disabled or no callback');\n      return;\n    }\n\n    const handleClick = (e: any) => {\n      console.log('ðŸŽ¯ MAP CLICKED event:', e);\n      const lat = e.latlng?.lat;\n      const lng = e.latlng?.lng;\n      console.log('ðŸŽ¯ MAP CLICKED at:', { lat, lng, isManualAddMode });\n      if (lat !== undefined && lng !== undefined) {\n        onMapClick(lat, lng);\n      }\n    };\n\n    console.log('âœ… Attaching click handler to map');\n    \n    // Try both methods\n    map.on('click', handleClick);\n    \n    return () => {\n      console.log('âŒ Detaching click handler');\n      map.off('click', handleClick);\n    };\n  }, [map, onMapClick, isManualAddMode]);\n\n  return null;\n};\n\ninterface RouteMapProps {\n  stops: Stop[];\n  selectedStops: Stop[];\n  center?: { lat: number; lng: number };\n  zoom?: number;\n  showRoute?: boolean;\n  height?: string;\n  onStopClick?: (stop: Stop) => void;\n  onFitRoute?: () => void;\n  showAllStops?: boolean;\n  onToggleShowAllStops?: () => void;\n  searchTerm?: string;\n  onSearchChange?: (term: string) => void;\n  filteredStops?: Stop[];\n  onAddStop?: (stop: Stop) => void;\n  onRemoveStop?: (stopId: string) => void;\n  onMapClick?: (lat: number, lon: number) => void;\n  isManualAddMode?: boolean;\n  onToggleManualMode?: () => void;\n  tempMarker?: { lat: number; lon: number } | null;\n}\n\nconst RouteMap: React.FC<RouteMapProps> = ({ \n  stops,\n  selectedStops,\n  center,\n  zoom = 12,\n  showRoute = true,\n  height,\n  onStopClick,\n  onFitRoute,\n  showAllStops = true,\n  onToggleShowAllStops,\n  searchTerm = '',\n  onSearchChange,\n  filteredStops = [],\n  onAddStop,\n  onRemoveStop,\n  onMapClick,\n  isManualAddMode = false,\n  onToggleManualMode,\n  tempMarker\n}) => {\n  // Default center - Qatar (Doha) if no center provided\n  const defaultCenter = center || { lat: 25.2854, lng: 51.5310 };\n  \n  // State for route data\n  const [routeData, setRouteData] = useState<RouteResponse | null>(null);\n  const [isCalculatingRoute, setIsCalculatingRoute] = useState(false);\n  const [isSearchDropdownOpen, setIsSearchDropdownOpen] = useState(false);\n\n  // Debug: Log stops and manual mode\n  useEffect(() => {\n    console.log('RouteMap Debug:', {\n      stopsCount: stops.length,\n      selectedStopsCount: selectedStops.length,\n      isManualAddMode,\n      showAllStops,\n      defaultCenter,\n      stopsArray: stops.slice(0, 3) // First 3 stops\n    });\n  }, [stops.length, selectedStops.length, isManualAddMode, showAllStops, defaultCenter]);\n\n  // Calculate route when selected stops change\n  useEffect(() => {\n    // Create an AbortController for this effect\n    const abortController = new AbortController();\n    let timeoutId: NodeJS.Timeout;\n\n    if (selectedStops.length >= 2 && showRoute) {\n      setIsCalculatingRoute(true);\n      \n      const waypoints: RouteCoordinate[] = selectedStops.map(stop => ({\n        lat: parseFloat(stop.location.lat.toString()),\n        lng: parseFloat(stop.location.lon.toString())\n      }));\n\n      // Create a stable key for this route calculation\n    //   const routeKey = waypoints.map(w => `${w.lat.toFixed(6)},${w.lng.toFixed(6)}`).join('|');\n      \n      // Add a longer delay to avoid excessive API calls during hot reload\n      timeoutId = setTimeout(async () => {\n        // Check if component is still mounted and request not aborted\n        if (abortController.signal.aborted) {\n          return;\n        }\n\n        try {\n          const route = await RoutingService.calculateRoute(waypoints, abortController.signal);\n          \n          // Check again if component is still mounted\n          if (!abortController.signal.aborted) {\n            setRouteData(route);\n            setIsCalculatingRoute(false);\n          }\n        } catch (error) {\n          // Only handle error if not aborted\n          if (!abortController.signal.aborted) {\n            console.error('Failed to calculate route:', error);\n            setIsCalculatingRoute(false);\n            // Fallback to straight line\n            setRouteData({\n              coordinates: waypoints,\n              distance: 0,\n              duration: 0\n            });\n          }\n        }\n      }, 1000); // Increased to 1 second to reduce hot reload requests\n\n    } else {\n      setRouteData(null);\n      setIsCalculatingRoute(false);\n    }\n\n    // Cleanup function\n    return () => {\n      abortController.abort();\n      if (timeoutId) {\n        clearTimeout(timeoutId);\n      }\n    };\n  }, [selectedStops, showRoute]);\n\n  // Create route line coordinates for Leaflet Polyline\n  const routeCoordinates: [number, number][] = routeData \n    ? routeData.coordinates.map(coord => [coord.lat, coord.lng])\n    : selectedStops.map(stop => [stop.location.lat, stop.location.lon]);\n\n  // Search handlers\n  const handleSearchChange = (value: string) => {\n    onSearchChange?.(value);\n    const shouldOpen = value.length > 0;\n    console.log('Search change:', value, 'Should open:', shouldOpen, 'Filtered stops:', filteredStops.length);\n    setIsSearchDropdownOpen(shouldOpen);\n  };\n\n  const handleSearchFocus = () => {\n    console.log('Search focus, searchTerm:', searchTerm, 'length:', searchTerm.length);\n    if (searchTerm.length > 0) {\n      setIsSearchDropdownOpen(true);\n    }\n  };\n\n  const handleSearchBlur = () => {\n    // Delay closing to allow for click on dropdown item\n    setTimeout(() => {\n      setIsSearchDropdownOpen(false);\n    }, 200);\n  };\n\n  const handleDropdownItemClick = (stop: Stop) => {\n    onAddStop?.(stop);\n    onSearchChange?.('');\n    setIsSearchDropdownOpen(false);\n  };\n\n  return (\n    <MapWrapper>\n      {onStopClick && (\n        <MapInfo>\n          <div style={{ fontSize: '12px', opacity: 0.8 }}>\n            ðŸ“ Click stops to add to route\n          </div>\n          {isCalculatingRoute && (\n            <div style={{ marginTop: '4px', fontSize: '12px', opacity: 0.8, color: '#3b82f6' }}>\n              ðŸ›£ï¸ Calculating road route...\n            </div>\n          )}\n          {selectedStops.length === 1 && (\n            <div style={{ marginTop: '4px', fontSize: '12px', opacity: 0.8 }}>\n              Add another stop to see route\n            </div>\n          )}\n        </MapInfo>\n      )}\n      \n      \n      {/* Map Sidebar */}\n      <MapSidebar>\n        <SidebarHeader>\n          <SidebarTitle>\n            ðŸ—ºï¸ Route Builder\n          </SidebarTitle>\n        </SidebarHeader>\n        \n        <SidebarContent>\n          {/* Controls Section */}\n          <ControlSection>\n            <ControlGroup>\n              {onToggleShowAllStops && (\n                <ToggleButton\n                  active={showAllStops}\n                  onClick={onToggleShowAllStops}\n                >\n                  ðŸ“ {showAllStops ? 'Hide All Stops' : 'Show All Stops'}\n                </ToggleButton>\n              )}\n              \n              {onToggleManualMode && (\n                <ToggleButton\n                  active={isManualAddMode}\n                  onClick={onToggleManualMode}\n                >\n                  ðŸ“Œ {isManualAddMode ? 'Stop Placement Mode' : 'Click to Add Stops'}\n                </ToggleButton>\n              )}\n              \n              {selectedStops.length >= 2 && onFitRoute && (\n                <ActionButton onClick={onFitRoute}>\n                  ðŸŽ¯ Fit Route to View\n                </ActionButton>\n              )}\n            </ControlGroup>\n          </ControlSection>\n          \n          {/* Search Section */}\n          <SearchSection>\n            <SearchContainer>\n              <SearchInput\n                type=\"text\"\n                placeholder=\"Search stops to add...\"\n                value={searchTerm}\n                onChange={(e) => handleSearchChange(e.target.value)}\n                onFocus={handleSearchFocus}\n                onBlur={handleSearchBlur}\n              />\n              \n              {/* Search Dropdown */}\n              <SearchDropdown isOpen={isSearchDropdownOpen}>\n                {filteredStops.length > 0 ? (\n                  filteredStops.map((stop) => {\n                    const isSelected = selectedStops.some(s => s.id === stop.id);\n                    return (\n                      <DropdownItem\n                        key={stop.id}\n                        selected={isSelected}\n                        onClick={() => !isSelected && handleDropdownItemClick(stop)}\n                      >\n                        <DropdownItemInfo>\n                          <DropdownItemName>{stop.name}</DropdownItemName>\n                          <DropdownItemCode>{stop.code}</DropdownItemCode>\n                        </DropdownItemInfo>\n                        {!isSelected && (\n                          <div style={{ color: theme.colors.primary, fontSize: '16px' }}>+</div>\n                        )}\n                      </DropdownItem>\n                    );\n                  })\n                ) : (\n                  <NoResults>\n                    No stops found for \"{searchTerm}\"\n                  </NoResults>\n                )}\n              </SearchDropdown>\n            </SearchContainer>\n          </SearchSection>\n          \n          {/* Selected Stops Section */}\n          <SelectedStopsSection>\n            <SelectedStopsHeader>\n              Selected Stops ({selectedStops.length})\n            </SelectedStopsHeader>\n            \n            <SelectedStopsList>\n              {selectedStops.length > 0 ? (\n                selectedStops.map((stop, index) => (\n                  <SelectedStopItem key={stop.id}>\n                    <StopOrder>{index + 1}</StopOrder>\n                    <StopInfo>\n                      <StopName>{stop.name}</StopName>\n                      <StopCode>{stop.code}</StopCode>\n                    </StopInfo>\n                    <RemoveButton onClick={() => onRemoveStop?.(stop.id)}>\n                      Ã—\n                    </RemoveButton>\n                  </SelectedStopItem>\n                ))\n              ) : (\n                <EmptyState>\n                  <div style={{ fontSize: '20px', marginBottom: '8px' }}>ðŸ“</div>\n                  <div style={{ fontSize: '12px', fontWeight: '500' }}>No stops selected</div>\n                  <div style={{ fontSize: '10px', marginTop: '4px', color: theme.colors.textMuted }}>\n                    Search and add stops to build your route\n                  </div>\n                </EmptyState>\n              )}\n            </SelectedStopsList>\n          </SelectedStopsSection>\n        </SidebarContent>\n      </MapSidebar>\n      \n      <MapContainer\n        center={[defaultCenter.lat, defaultCenter.lng]}\n        zoom={zoom}\n        style={{ height: '100%', width: '100%' }}\n      >\n        <TileLayer\n          attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        \n        {/* Handle automatic bounds fitting when stops change */}\n        <MapBoundsHandler selectedStops={selectedStops} />\n        {/* Handle fitting all stops into view when they load */}\n        <FitAllStopsHandler stops={stops} />\n        \n        {/* Handle map clicks for manual stop addition */}\n        <MapClickHandler onMapClick={onMapClick} isManualAddMode={isManualAddMode} />\n        \n        {/* Show all available stops */}\n        {(() => {\n          console.log('ðŸ—ºï¸ MAP RENDERING:', { stopsLength: stops.length, showAllStops });\n          const markers = stops.map((stop) => {\n            const isSelected = selectedStops.some(s => s.id === stop.id);\n            const selectedIndex = selectedStops.findIndex(s => s.id === stop.id);\n            \n            // Only show non-selected stops if showAllStops is true\n            if (!isSelected && !showAllStops) {\n              console.log('â­ï¸ SKIPPING STOP:', stop.name, '(not selected & showAllStops is false)');\n              return null;\n            }\n            \n            const lat = parseFloat(stop.location.lat.toString());\n            const lon = parseFloat(stop.location.lon.toString());\n            \n            console.log('ðŸ“ MARKER RENDER:', {\n              name: stop.name,\n              lat,\n              lon,\n              isSelected\n            });\n            \n            return (\n              <Marker\n                key={stop.id}\n                position={[lat, lon]}\n                icon={isSelected ? selectedIcon : defaultIcon}\n                eventHandlers={{\n                  click: () => {\n                    if (onStopClick) {\n                      onStopClick(stop);\n                    }\n                  }\n                }}\n              >\n                <Popup>\n                  <PopupContent>\n                    <PopupTitle>{stop.name}</PopupTitle>\n                    <PopupDetail><strong>Code:</strong> {stop.code}</PopupDetail>\n                    {isSelected && (\n                      <PopupDetail><strong>Order:</strong> #{selectedIndex + 1} in route</PopupDetail>\n                    )}\n                    {onStopClick && !isSelected && (\n                      <PopupDetail style={{ color: theme.colors.primary, fontWeight: 'bold', marginTop: '8px' }}>\n                        Click to add to route\n                      </PopupDetail>\n                    )}\n                  </PopupContent>\n                </Popup>\n              </Marker>\n            );\n          });\n          console.log('ðŸŽ¨ TOTAL MARKERS RENDERED:', markers.filter(m => m !== null).length);\n          return markers;\n        })()}\n        \n        {/* Show temporary marker when adding stop manually */}\n        {(() => {\n          console.log('ðŸ”´ TEMP MARKER CHECK:', {\n            tempMarker,\n            isManualAddMode,\n            shouldRender: tempMarker && isManualAddMode\n          });\n          \n          if (tempMarker && isManualAddMode) {\n            const lat = parseFloat(tempMarker.lat.toString());\n            const lon = parseFloat(tempMarker.lon.toString());\n            \n            console.log('ðŸ”´ RENDERING TEMP MARKER at:', { lat, lon });\n            \n            return (\n              <Marker\n                position={[lat, lon]}\n                icon={tempIcon}\n              >\n                <Popup>\n                  <PopupContent>\n                    <PopupTitle>New Stop Location</PopupTitle>\n                    <PopupDetail><strong>Lat:</strong> {lat.toFixed(6)}</PopupDetail>\n                    <PopupDetail><strong>Lon:</strong> {lon.toFixed(6)}</PopupDetail>\n                  </PopupContent>\n                </Popup>\n              </Marker>\n            );\n          }\n          return null;\n        })()}\n        \n        {/* Show route line */}\n        {showRoute && selectedStops.length > 1 && routeCoordinates.length > 0 && (\n          <Polyline\n            positions={routeCoordinates}\n            color={routeData ? theme.colors.primary : theme.colors.secondary}\n            weight={routeData ? 5 : 4}\n            opacity={routeData ? 0.9 : 0.6}\n            dashArray={routeData ? undefined : \"10, 5\"}\n          />\n        )}\n      </MapContainer>\n    </MapWrapper>\n  );\n};\n\nexport default RouteMap;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}